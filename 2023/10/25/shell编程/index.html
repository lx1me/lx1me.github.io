

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="shell编程循环逻辑 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989">
<meta property="og:type" content="article">
<meta property="og:title" content="关于">
<meta property="og:url" content="https://lx1me.github.io/2023/10/25/shell%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="shell编程循环逻辑 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lx1me.github.io/image/image_tegX53efeC.png">
<meta property="og:image" content="https://lx1me.github.io/image/image__lvjriwNww.png">
<meta property="og:image" content="https://lx1me.github.io/image/image_WVA8hRwnNT.png">
<meta property="article:published_time" content="2023-10-24T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-09T03:58:34.097Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="随笔">
<meta property="article:tag" content="记录">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://lx1me.github.io/image/image_tegX53efeC.png">
  
  
  
  <title>关于 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/scroll.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/gradient.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"lx1me.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 60vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="关于"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-10-25 00:00" pubdate>
          2023年10月25日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          30 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="text-center">
  <div class="about-info">
    <div class="about-name">Fluid</div>
    <div class="about-intro">An elegant theme for Hexo</div>
    <div class="about-icons">
      
        
        
        
        <a href=https://github.com class="
           hint--bottom hint--rounded"
           aria-label="GitHub"
           target="_blank"
        >
          <i class="iconfont icon-github-fill" aria-hidden="true"></i>
          
        </a>
      
        
        
        
        <a href=https://douban.com class="
           hint--bottom hint--rounded"
           aria-label="豆瓣"
           target="_blank"
        >
          <i class="iconfont icon-douban-fill" aria-hidden="true"></i>
          
        </a>
      
        
        
        
        <a  class="qr-trigger
           "
           
           target="_self"
        >
          <i class="iconfont icon-wechat-fill" aria-hidden="true"></i>
          
            <img class="qr-img" src="/img/favicon.png" srcset="/img/loading.gif" lazyload alt="qrcode" />
          
        </a>
      
    </div>
  </div>
</div>

<article class="about-content page-content mt-5">
  <div class="markdown-body">
    <h1 id="shell编程"><a href="#shell编程" class="headerlink" title="shell编程"></a>shell编程</h1><p>循环逻辑</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs ada">循环逻辑<br>循环逻辑语法解析：<br>     关键字 [ 条件 ]<br>     <span class="hljs-keyword">do</span><br>         执行语句<br>     done<br> <br>  注意：<br>     这里的关键字主要有四种：<br>     <span class="hljs-keyword">for</span> - 循环遍历一个元素列表<br>     <span class="hljs-keyword">while</span> - 满足条件情况下一直循环下去<br>     until - 不满足条件情况下一直循环下去<br><br><span class="hljs-keyword">for</span>循环<br>  场景：遍历列表<br>      <span class="hljs-keyword">for</span> 值 <span class="hljs-keyword">in</span> 列表<br>      <span class="hljs-keyword">do</span><br>         执行语句<br>      done<br>  列表生成 <br>    样式<span class="hljs-number">1</span>：手工列表<br>      - <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span><br>    样式<span class="hljs-number">2</span>：定制列表<br>      - &#123;<span class="hljs-number">1</span>..<span class="hljs-number">7</span>&#125;<br>    样式<span class="hljs-number">3</span>：命令生成<br>      - $(seq <span class="hljs-number">1</span> <span class="hljs-number">7</span>)<br>    样式<span class="hljs-number">4</span>：脚本参数<br>      - $@ $*<br><br><span class="hljs-keyword">while</span>循环<br>  场景：只要条件满足，就一直循环下去<br>    <span class="hljs-keyword">while</span> [ 条件判断 ]<br>    <span class="hljs-keyword">do</span><br>       执行语句<br>    done  <br>  注意：<br>    条件支持的样式 命令、[[ 字符串表达式 ]]、(( 数字表达式 ))<br>    <span class="hljs-literal">true</span>是一个特殊的条件，代表条件永远成立<br><br>until循环<br>  场景：只要条件不满足，就一直循环下去<br>    until [ 条件判断 ]<br>    <span class="hljs-keyword">do</span><br>       执行语句<br>    done  <br>    注意：<br>    条件支持的样式 命令、[[ 字符串表达式 ]]、(( 数字表达式 ))<br>    <span class="hljs-literal">false</span>是一个特殊的条件，代表条件永远不成立  <br><br>循环控制<br>  所谓的流程控制，主要针对的是，当我们处于流程步骤执行的过程中，因为某些特殊的原因，不得不停止<br>既定的操作进行步骤的调整  <br>  <br>  continue控制<br>     - 满足条件的情况下，临时停止当前的循环，直接进入到下一循环<br>    continue主要有两种场景的表现样式：<br>        单循环场景下，continue是跳出当前循环<br>           - 仅有一层 <span class="hljs-keyword">while</span> 、<span class="hljs-keyword">for</span>、until等<br>        嵌套循环场景下，continue是可以跳出内层循环和外层循环。<br>           - 存在多层<span class="hljs-keyword">while</span>、<span class="hljs-keyword">for</span>、until嵌套等   <br>    <br>   continue语法格式：<br>        <span class="hljs-keyword">for</span> 循环列表<br>        <span class="hljs-keyword">do</span><br>           ...<br>           continue num<br>        done<br> 注意：<br> 单循环下，continue就代表跳出当前循环<br> 多循环下，continue的num就代表要继续的循环级别 <br>     <br>     <br>     <br>  break控制<br>     - 满足条件的情况下，提前退出当前的循环<br>    break命令是在处理过程中终止循环的一种简单方法。可以使用break命令退出任何类型的循环，包括<br><span class="hljs-keyword">for</span>、<span class="hljs-keyword">while</span>、until等。     <br>     break主要有两种场景的表现样式：<br>         单循环场景下，break是终止循环<br>              - 仅有一层 <span class="hljs-keyword">while</span> 、<span class="hljs-keyword">for</span>、until等<br>         嵌套循环场景下，break是可以终止内层循环和外层循环。<br>              - 存在多层<span class="hljs-keyword">while</span>、<span class="hljs-keyword">for</span>、until嵌套等     <br>       <br>       break语法格式：<br>          <span class="hljs-keyword">for</span> 循环列表<br>          <span class="hljs-keyword">do</span><br>               ...<br>               break num<br>          done<br> 注意：<br> 单循环下，break就代表退出循环<br> 多循环下，break的num大于嵌套的层数，就代表退出循环<br>     <br> <br> <br>  <span class="hljs-keyword">exit</span>控制<br>     - 直接退出当前循环的程序<br>  shift控制<br>     - 依次从循环列表中读取读取内容，并将读取的内容从列表中剔除      <br>    <br> <br></code></pre></td></tr></table></figure>


<p>!!!!<img src="/../image/image_tegX53efeC.png" srcset="/img/loading.gif" lazyload></p>
<p>!!!!<img src="/../image/image__lvjriwNww.png" srcset="/img/loading.gif" lazyload></p>
<p>函数</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs ada">基础知识<br><br><br>  函数的优势：<br>    <span class="hljs-number">1</span>. 代码模块化，调用方便，节省内存<br>    <span class="hljs-number">2</span>. 代码模块化，代码量少，排错简单<br>    <span class="hljs-number">3</span>. 代码模块化，可以改变代码的执行顺序<br>  <br>  基本语法<br>    定义函数：<br>      <br>      样式<span class="hljs-number">1</span>：标准格式<br>      <span class="hljs-keyword">function</span> <span class="hljs-title">函数名&#123;</span> <br>          函数体 <br>      &#125; <br>      <br>      样式2：简约格式<br>      函数名() &#123; <br>         函数体 <br>      &#125;<br>注意：<br> <span class="hljs-keyword">function</span> <span class="hljs-title">的作用和</span> () 的作用是一样的，都是定义一个函数。<br> 函数的名称是自定义的，而且在脚本范围内必须唯一。<br> 函数体内是普通的能够正常执行的命令，命令的执行流程符合顺序逻辑。<br>    <br>    调用函数： <br>       函数名 <br>    注意：<br>        函数名出现在任何位置，就代表在该位置调用函数内代码块的执行。<br>        函数名一般在函数定义后调用，否则的话会发生报错。     <br><br>函数表现样式：<br>  1.最简单的功能代码块<br>     关注的是命令的执行<br>  2.稍显繁琐的功能代码块<br>      -最简单的功能代码块+简单逻辑判断<br>  3.更复杂的函数调用<br>     关注的是代码逻辑的实现<br><br><br>传参函数：<br>  定义函数：<br>    函数名() &#123; <br>        函数体 $&#123;变量名&#125; <br>    &#125;<br>注意：<br>   函数体内通过 $&#123;变量名&#125; 来实现函数体的功能通用性。    <br><br>调用函数： <br>   函数名 参数 <br>注意：<br>   函数在调用的时候，接收一些参数并传输到函数体内部。<br><br>函数退出：<br>  样式1-默认的退出状态<br>       默认情况下，函数的退出状态是函数体内的最后一条命令的退出状态，可以通过 $? 来获取<br>  样式2-<span class="hljs-keyword">return</span>定制状态返回值<br>       在函数体内部，通过<span class="hljs-keyword">return</span>定制状态返回值的内容<br>       应用场景：主动退出函数的功能<br>  注意：<br>      <span class="hljs-keyword">return</span>的状态返回值必须尽快使用，否则会被其他<span class="hljs-keyword">return</span>的值覆盖<br>      <span class="hljs-keyword">return</span>的状态返回值必须在 0-255，否则失效      <br><br>函数变量：<br>  变量类型：<br>    全局变量:<br>        默认情况下，脚本中的普通变量就是全局变量，作用范围是shell脚本的所有地方，在函数内部也可以正常使用<br>        而且函数内可以可以修改脚本级别的全局变量<br>    局部变量:<br>        我们可以通过local语法，将变量的作用范围限制在一段代码块范围中。<br>        注意：脚本内无法使用local语法，仅限于函数体内     <br></code></pre></td></tr></table></figure>


<p>脚本自动化</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs ada">当我们在构建一些更高级的脚本的时候，就会涉及到如何在linux系统上来更好的运行和控制它们，到目前为止，我们运行脚本的方式都是以实时的模式，在命令行来运行它。但是这并不是脚本唯一的运行方式，我们可以在linux系统中以更丰富的方式来运行它们，甚至在脚本遇到不可查的异常中止时候，以关闭linux终端界面的方式终止脚本。<br>   这些能力都是基于信号的机制来实现了<br><br>重复性工作|无需人工干预，可以实现自动根据书记来进行判断并执行<br>获取数据的方式：<br>  半自动化：read<br>  自动化（代码级别）：信号|expect<br><br>ps aux 查看进程<br><br>生成信号<br>  终止进程：<br>     ctrl+c,<br>  暂停进程:(挂起进程)<br>     ctrl+z,停止的进程继续保留在内存中，并能从停止的位置继续运行<br>  恢复进程:<br>     jobs查看运行任务，fg num 重新执行<br>  杀死进程:<br>     kill -<span class="hljs-number">9</span> pid<br><br>expect基础<br>  场景需求:<br>    在日常工作中，经常会遇到各种重复性的<span class="hljs-string">&quot;手工交互&quot;</span>操作，虽然没有什么技术含量，但是相当的重要。在实际的工作场景中，这种重复性的手工操作动作，非常的繁多，但是对于量大的工作来说，效率就非常低效了。所以我们就需要有一种工具，能够简化我们重复的手工操作。  <br><br>  expect是一个免费的编程工具它可以根据程序的提示，模拟标准输入提供给程序，从而实现自动的交互式任务，而无需人为干预,可以用作Unix系统中进行应用程序的自动化控制和测试的软件工具。  <br>  yum install expect -y 安装软件<br>  expect  进入专用的命令交互界面       <br>     <br>常见符号:<br>  &#123; &#125;：代码块<br>      作用<span class="hljs-number">2</span>：代码块儿，但是两个 &#123;&#125; 边界必须在一起。<br>         正确样式：<br>         <span class="hljs-keyword">if</span> &#123;代码块<span class="hljs-number">1</span> &#125; &#123;<br>             代码块<span class="hljs-number">2</span><br>             &#125;<br>         错误示例：<br>         <span class="hljs-keyword">if</span> &#123;$count &lt; <span class="hljs-number">0</span>&#125;<br>            &#123;<br>             break;<br>            &#125;<br> 注意：<br> 无论什么时候，&#123;&#125;边界符号与其他内容都最好有空格隔开，尤其是边界外的内容  <br><br>常用命令:<br>  set 设定环境变量      #在shell中是变量名=变量值<br>     格式：set 变量名 变量值<br>     样式：set host <span class="hljs-string">&quot;192.168.8.12&quot;</span><br> <br>  spawn 启动新的进程，模拟手工在命令行启动服务<br>     格式：spawn 手工执行命令<br>     样式：spawn ssh python@$host<br>  expect 接收一个新进程的反馈信息，我们根据进程的反馈，再发送对应的交互命令<br>     格式：expect <span class="hljs-string">&quot;交互界面用户输入处的关键字&quot;</span><br>     样式：expect <span class="hljs-string">&quot;*password*&quot;</span><br> <br>  send 接收一个字符串参数，并将该参数发送到新进程。<br>     格式：send <span class="hljs-string">&quot;用户输入的信息&quot;</span> <br>     样式：send <span class="hljs-string">&quot;$password\r&quot;</span><br> <br>  interact 退出自动化交互界面，进入用户交互状态，如果需要用户交互的话，这条命令必须在最后一行<br>     格式：interact<br>     样式：interact  <br><br>脚本结合:<br>  expect 除了使用专用的expect脚本来实现特定功能之外，它还可以与其他脚本嵌套在一起进行使用。最常用的结合方式就是 shell结合。<br>  在于shell结合使用的时候，无非就是将expect的执行命令使用 &lt;&lt;-EOF  。。。 EOF 包装在一起即可。<br>  样式：<br>  /usr/bin/expect&lt;&lt;-EOF<br>  spawn ...<br>  ...<br>  expect eof <br>  EOF<br>注意：<br>  由于expect在shell中是作为一个子部分而存在的，所以，一般情况下，expect结束的时候，使用eof命令表示expect的内容到此结束<br>  <br>高级赋值:<br>  所谓的高级赋值，是另外的一种变量值获取方法，这里涉及到更多我们学习之外的一些shell内置变量格式,其实这部分的内容主要还是在字符串的基础上，如何更精细的获取特定的信息内容：主要涉及到的内容样式<br><br>  字符串截取按分隔符截取: # 右 % 左<br>    $&#123;file#/&#125;   删除匹配结果，保留第一个/右边的字符串<br>    $&#123;file##/&#125; 删除匹配结果，保留最后一个/右边的字符串<br>    $&#123;file%/&#125; 删除匹配结果，保留第一个/左边的字符串<br>    $&#123;file%%/&#125; 删除匹配结果，保留最后一个/左边的字符串<br>    注意：<br>        匹配内容的正则表达式，尽量不要出现特殊边界字符    <br><br>  字符串替换<br>    $&#123;file/dir/path&#125; 把第一个dir替换成path：/path1/dir2/dir3/n<br>    $&#123;file//dir/path&#125; 把所有dir替换成path：/path1/path2/path3/n<br>    $&#123;file/#dir/path&#125; 将从左侧能匹配到的dir，则替换成 path 然后返回；否则直接返回$&#123;var&#125;。<br>    $&#123;file/%dir/path&#125; 将从右侧能匹配到的dir，则替换成 path 然后返回；否则直接返回$&#123;var&#125;。<br>    注意：<br>        如果匹配内容使用的是正则符号，应该注意正则符号的写法  <br><br>  字符串转换<br>    $&#123;file^^&#125; 把file中的所有小写字母转换为大写<br>    $&#123;file,,&#125; 把file中的所有大写字母转换为小写   <br>  <br>嵌套变量:<br>  场景<span class="hljs-number">1</span>：我们知道，命令变量的的表现样式：<br>      ver=$(命令)<br>      <span class="hljs-comment">-- 执行原理是，当`` 或者 $() 范围中存在能够正常解析的命令的话，会先执行命令，然后将命令执行的结果交个一个变量名。</span><br>  场景<span class="hljs-number">2</span>：它还有另外一种样式 <span class="hljs-comment">-- 普通变量的第三种样式双引号</span><br>     ming=shuji; name=<span class="hljs-string">&quot;wang-$ming&quot;</span><br>     <span class="hljs-comment">-- 解析原理：双引号会首先查看变量值范围内是否有可以解析的变量名，如果有的话，将解析后的结果放到变量值范围内，组合成一个新的变量值，然后交给变量名。    </span><br>  <br>在shell中，它提供了一个专属的命令，可以实现多层隐藏命令的解析，不仅仅能够解析，还能够将相关环境的属性重现，从而实现多层隐藏命令的顺利执行。这个命令就是 eval。 <br>eval原理<br> <span class="hljs-number">1</span> eval命令将会首先扫描命令行整体<br> <span class="hljs-number">2</span> 发现解析则解析，发现执行则预先执行，实现所有隐藏命令的成功执行<br> <span class="hljs-number">3</span> 将隐藏命令执行的最终结果进行置换<br> <span class="hljs-number">4</span> 最后执行命令行表面的命令。    <br>    <br><br><br><br><br><br><br><br>     <br><br></code></pre></td></tr></table></figure>


<p>案例(跨主机免密码认证)</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs ada">使用密钥认证<br><span class="hljs-number">1</span>.本地主机生成密钥对<br>  ssh-keygen -t rsa -P <span class="hljs-string">&quot;&quot;</span> -f ~/.ssh/id_rsa<br>  <br><span class="hljs-number">2</span>.把公钥信息传递给远程主机的指定用户<br>  ssh-copy-id -i /root/.ssh/id_rsa.pub root@<span class="hljs-number">10.0</span>.<span class="hljs-number">0.15</span>  <br><br><span class="hljs-number">3</span>.在主机上测试一下<br>  ssh root@<span class="hljs-number">10.0</span>.<span class="hljs-number">0.15</span> ip a<br>  <br>定制脚本文件  remotehost_sshkey_auth.sh<br>  <br><br><br>#!bin/bash<br>user_dir=<span class="hljs-string">&quot;/root&quot;</span><br>login_user=<span class="hljs-symbol">&#x27;root</span>&#x27;<br>login_pass=&#x27;<span class="hljs-number">123456</span>&#x27;<br># 定制数组变量<br>target_type=(部署 免密 退出)<br># 定制安装软件的函数<br>expect_install()&#123;<br>    yum install expect -y &gt;&gt; /dev/null<br>    echo <span class="hljs-string">&quot;软件安装完毕&quot;</span><br>&#125;<br># 定制ssh秘钥对的生成<br>sshkey_create()&#123;<br>    # 清理历史秘钥<br>    [ -d $&#123;user_dir&#125;/.ssh ] &amp;&amp; rm -rf $&#123;user_dir&#125;/.ssh<br>    # 生成新的秘钥<br>    ssh-keygen -t rsa -P <span class="hljs-string">&quot;&quot;</span> -f $&#123;user_dir&#125;/.ssh/id_rsa &gt;&gt; /dev/null<br>    echo <span class="hljs-string">&quot;秘钥生成完毕&quot;</span><br>&#125;<br># 定制expect的认证逻辑<br>expect_process()&#123;<br>    command=<span class="hljs-string">&quot;$@&quot;</span><br>    expect -c <span class="hljs-string">&quot;</span><br><span class="hljs-string">        spawn $&#123;command&#125;</span><br><span class="hljs-string">        expect &#123;</span><br><span class="hljs-string">            \&quot;</span>*yes/no*\<span class="hljs-string">&quot; &#123;send \&quot;</span>yes\r\<span class="hljs-string">&quot;; exp_continue&#125;</span><br><span class="hljs-string">            \&quot;</span>*password*\<span class="hljs-string">&quot; &#123;send \&quot;</span>$&#123;login_pass&#125;\r\<span class="hljs-string">&quot;; exp_continue&#125;</span><br><span class="hljs-string">            \&quot;</span>*Password*\<span class="hljs-string">&quot; &#123;send \&quot;</span>$&#123;login_pass&#125;\r\<span class="hljs-string">&quot;;&#125;</span><br><span class="hljs-string">        &#125;&quot;</span><br>&#125;<br># 跨主机密码认证<br>sshkey_auth()&#123;<br>    local host_list=<span class="hljs-string">&quot;$1&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $&#123;host_list&#125;; <span class="hljs-keyword">do</span><br>        command=<span class="hljs-string">&quot;/usr/bin/ssh-copy-id -i /root/.ssh/id_rsa.pub&quot;</span><br>        remote=<span class="hljs-string">&quot;$&#123;login_user&#125;@$i&quot;</span><br>        expect_process <span class="hljs-string">&quot;$&#123;command&#125; $&#123;remote&#125;&quot;</span><br>    done<br>&#125;<br># 定制服务的操作提示功能函数<br>menu()&#123;<br>    echo -e <span class="hljs-string">&quot;\e[31m---------------管理平台操作界面---------------&quot;</span><br>    echo -e <span class="hljs-string">&quot; 1: 秘钥准备 2: 免密认证 3: 退出操作&quot;</span><br>    echo -e <span class="hljs-string">&quot;-------------------------------------------\033[0m&quot;</span><br>&#125;<br># 定制脚本帮助信息<br>Usage()&#123;<br>    echo <span class="hljs-string">&quot;请输入有效的操作标识!!!&quot;</span><br>&#125;<br># 定制业务逻辑<br><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span><br>    menu<br>    read -p <span class="hljs-string">&quot;&gt; 请输入要操作的目标类型: &quot;</span> target_id<br><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;$&#123;target_type[$((target_id-1))]&#125;&quot;</span> == <span class="hljs-string">&quot;部署&quot;</span> ]; <span class="hljs-keyword">then</span><br>        echo <span class="hljs-string">&quot;开始部署秘钥环境...&quot;</span><br>        expect_install<br>        sshkey_create<br>    elif [ <span class="hljs-string">&quot;$&#123;target_type[$((target_id-1))]&#125;&quot;</span> == <span class="hljs-string">&quot;免密&quot;</span> ]; <span class="hljs-keyword">then</span><br>        read -p <span class="hljs-string">&quot;&gt; 请输入免密10.0.0网段主机的范围，示例&#123;12..19&#125;: &quot;</span> num_list<br>        # 验证输入格式<br>        <span class="hljs-keyword">if</span> [[ ! $num_list =~ ^\&#123;[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]+\.\.[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]+\&#125;$ ]]; <span class="hljs-keyword">then</span><br>            echo <span class="hljs-string">&quot;输入的网段范围格式不正确！请使用 &#123;start..end&#125; 格式&quot;</span><br>            continue<br>        fi<br>        # 解析网段范围<br>        ip_list=$(eval echo <span class="hljs-number">10.0</span>.<span class="hljs-number">0</span>.$&#123;num_list&#125;)<br>        sshkey_auth <span class="hljs-string">&quot;$&#123;ip_list&#125;&quot;</span><br>    elif [ <span class="hljs-string">&quot;$&#123;target_type[$((target_id-1))]&#125;&quot;</span> == <span class="hljs-string">&quot;退出&quot;</span> ]; <span class="hljs-keyword">then</span><br>        echo <span class="hljs-string">&quot;准备退出管理操作界面...&quot;</span><br>        <span class="hljs-keyword">exit</span><br>    <span class="hljs-keyword">else</span><br>        Usage<br>    fi<br>done<br><br><br></code></pre></td></tr></table></figure>


<p>!!!!<img src="/../image/image_WVA8hRwnNT.png" srcset="/img/loading.gif" lazyload></p>

  </div>

  
    <!-- Comments -->
    <article id="comments" lazyload>
      
      
        
      
      

    </article>
  
</article>





  



  



  



  



  





    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/DynamicRibbon.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/runtime.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/snowflake.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/Cherry.min.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
