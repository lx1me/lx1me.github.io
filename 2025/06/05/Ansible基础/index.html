<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Hexo | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Hexo"><meta name="application-name" content="Hexo"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Hexo"><meta property="og:url" content="https://lx1me.github.io/2025/06/05/Ansible%E5%9F%BA%E7%A1%80/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="Ansible基础本笔记介绍了Ansible的基本概念、工作特性、使用场景、架构解析、工作流程以及常用命令和配置文件结构。内容经过优化润色，保留了原始信息并增加了总结和注意事项，使条理更加清晰，重点更突出。所有正文内容均以 ada 代码块呈现，标题和章节采用标准 Markdown 语法，便于一次性复"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="John Doe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="Ansible基础本笔记介绍了Ansible的基本概念、工作特性、使用场景、架构解析、工作流程以及常用命令和配置文件结构。内容经过优化润色，保留了原始信息并增加了总结和注意事项，使条理更加清晰，重点更突出。所有正文内容均以 ada 代码块呈现，标题和章节采用标准 Markdown 语法，便于一次性复"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://lx1me.github.io/2025/06/05/Ansible%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: John Doe","link":"链接: ","source":"来源: Hexo","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Hexo',
  title: 'Hexo',
  postAI: '',
  pageFillDescription: 'Ansible基础, 1. Ansible简介, 2. Ansible的工作特性, 3. 使用场景, 4. 架构解析与工作流程, 5. Ansible命令执行来源, 6. 软件部署与需求, 7. 软件环境与常见命令, 8. Ansible管理方式, 9. 命令格式与模块, 10. 主配置文件结构, 11. 模块与命令示例, 12. 主机清单, 13.目标主机匹配, 14.命令执行流程, 日常命令操作模块, command模块, shell模块, scripts模块, 系统管理模块, hostname模块, user模块, group模块, getent命令可以用来察看系统的数据库中的相关记录 经常使用getent查看用户账号, cron模块, setup模块, selinux模块, mount模块, sysctl模块, 文件管理模块, copy模块, fetch模块, file模块, stat模块, 压缩包模块, Get_url模块, archive模块, unarchive模块, 编辑模块, Lineinfile模块, Replace模块, 软件模块, apt模块, apt_repository模块1, yum模块, yum_repository模块, service模块, 信息模块, Setup模块, debug模块, 相关命令, ansible-console, ansible-playbook, ansible-vault, ansible-galaxy, Playbook, playbook基础, YAML基础, 三种常见的数据格式, 基本样式一：YAML Maps, 基本样式二：YAML Lists, playbook常见组件, hosts属性, remote_user属性, tasks属性基础本笔记介绍了的基本概念工作特性使用场景架构解析工作流程以及常用命令和配置文件结构内容经过优化润色保留了原始信息并增加了总结和注意事项使条理更加清晰重点更突出所有正文内容均以代码块呈现标题和章节采用标准语法便于一次性复制使用简介是一个开源软件提供配置管理应用程序部署自动化云服务管理等项目通用的管理功能主要运行在类系统上也支持系统利用特性语言描述各种资源对象从而管理系统资源的工作特性基础属性开发基于语言实现部署依靠和实现简单部署安全基于加密方式传输数据无需代理不依赖具有命令执行的幂等性功能属性设计采用插件化方式实现定制功能关键三大关键模块定制支持自定义功能模块模块的使用方法类似于专用命令进阶属性劣势由于通信基于因此受限制较多尤其在主机量大时存在性能损耗问题解决方案可采用专用代理或客户端方式以提高效率使用场景可用于自动化云服务管理自动化设备管理自动化应用部署自动化配置管理自动化持续交付自动化安全管理一句话概括业务环境的自动化管理架构解析与工作流程架构解析采用三层结构用户端控制端被控端工作流程用户通过命令或向控制端发起请求控制端检查主机列表验证目标主机是否存在若目标存在控制端通过连接插件与被控端建立连接控制端根据用户指令和功能模块指定目标主机执行相应任务被控端执行任务后将状态结果返回给控制端控制端通过插件实现日志记录邮件通知等辅助功能命令执行来源的命令可通过以下方式执行系统用户直接在终端中执行命令在中间接执行中包含多条命令依次执行通过管理界面执行通过调用执行配置接口让第三方应用调用执行命令软件部署与需求通用环境需求服务端与客户端均基于协议通信须提前配置环境控制端需求控制端需运行在类系统上不支持需预先安装或环境被控端需求一般功能无需预装但若涉及业务则需配置相应版本若被控端版本小于则需安装若启用则需安装只能作为被控端使用软件环境与常见命令常见的可执行命令包括主命令用于执行任务配置管理命令交互式命令行工具模块帮助命令扩展命令用于获取角色模板文件任务管理工具主要用于长期规划大型项目反模式工作命令文件加密工具管理方式主要管理方式直接使用命令在远程主机上执行单个任务适用于临时操作适用于长期规划大型项目需要预先编写剧本命令格式与模块通用命令格式目标主机参数专用格式目标主机模块模块参数说明命令允许用户快速在远程主机上执行单条任务无需编写完整剧本的主要功能均通过各类插件模块实现默认模块为主配置文件结构默认配置文件和目录主配置文件定义工作特性可在项目目录下创建独立配置文件当前目录的优先级最高主机清单文件存放角色的目录配置文件优先级由高到低环境变量当前目录下的当前用户家目录下的模块与命令示例模块默认模块无需使用指定可直接通过传入命令参数执行示例目标主机命令参数模块用于检测目标主机的连通性示例命令用于查看模块的帮助信息示例完整帮助或简要帮助命令管理配置信息查看当前配置查看默认环境变量列出详细配置项创建初始化配置文件主机清单主机清单文件默认文件可在项目目录下创建独立的文件以区分不同项目格式风格组名写在中括号中同一主机可归属于多个组主机描述方式可以使用地址或主机名并可指定非默认端口用冒号标识主机列表形式主机清单的描述方式有两种主机地址和主机名主机列表有两种形式散列主机列表和主机组列表散列主机列表主机组列表嵌套主机组列表主机列表范围形式可以使用起始值结束值样式来表示主机名方式表示台目标主机主机地址表示台目标主机主机组名列表样式组名只能包含了字母数字下划线符号主机做的免密认证通信方式连接目标主机主要是通过协议的方式认证列表会将连接成功的主机列表信息记录到的认证列表中这个警告信息来自它指出在目标主机地址为上使用的是位于的解释器然而警告中提到未来如果安装了另一个解释器这个路径的含义可能会改变这可能会导致脚本执行时出现问题为了解决这个问题我们可以采取指定解释器路径的方法来解决把之前的主机改成目标主机匹配匹配规则对于目标的匹配规则来说他们的获取方式和表现样式主要有这么几种匹配所有正则匹配通配符逻辑或并集一般用于主机组逻辑与交集一般用于主机组逻辑非补集一般用于主机组命令执行流程命令执行过程加载配置文件默认加载的是加载指定模块获取目标主机与主机列表进行匹配认证指挥目标主机执行命令控制端生成临时执行文件通过连接插件与目标主机建立连接通过插件功能将控制端的临时执行文件传输至目标主机的临时目录数字文件指挥目标主机给临时执行文件添加执行权限目标主机执行临时文件并将结果返回给控制主机目标主机删除临时执行文件然后断开连接控制端显示结果并退出日常命令操作模块模块的默认模块可以运行远程权限所有的命令命令格式模块在使用的时候标准的写法是目标主机可执行命令注意由于的默认模块就是所以远程执行命令的时候一般会忽略选项效果如下目标主机可执行命令可执行命令就是我们平常在命令行输入的一些执行成功的命令但是不允许是别名不支持可执行命令中的自定义变量和特殊符号等以列表或者字符串格式输入命令执行命令前先切换工作路径依赖存在对象的命令若被创建的对象已存在则不执行该命令以自由格式输入参数这是一个强制的选项依赖移除对象的命令若被移除的对象存在则执行该命令设定标准输入作为参数警告信息需要的配置文件的的属性值是默认情况下可执行命令中不允许出现命令别名和管道符等特殊服务号对于系统默认的环境变量可以正常执行但是涉及到一些自定义变量和特殊符号就不行了模块对于某些特殊的符号命令执行效果不好专用的模块可以满足要求同同设置执行命令的类型同同同同命令格式模块在使用的时候标准的写法是目标主机可执行命令注意可执行命令就是我们平常在命令行输入的一些执行成功的命令支持可执行命令中的所有效果在远程执行脚本的时候必须远程主机存在否则的话会报错模块批量的系统命令可以写成一个脚本文件然后基于的方式来运行类似的功能专门用于执行复杂脚本场景的功能模块命令格式模块在使用的时候标准的写法是目标主机可执行命令注意就是不但可以执行目标主机上的脚本文件而且还能执行目标主机不存在的控制端特有的脚本文件对于控制端的脚本文件执行的时候必须使用此模块不具有幂等性命令执行成功的标志标准的输出信息在系统管理模块模块该模块可以获取主机名相关的信息模块在使用的时候标准的写法是目标主机主机名注意主机名的设置一定要规范这种方式更改的主机名是立刻生效而且是永久生效的模块模块主要是用于对远程主机的用户进行干预操作常见属性用户的描述信息设定用户的主组信息设置用户家目录设置登录密码设定用户的专用类型设定用户的存活状态设定用户是否为系统用户设定用户设定删除用户及家目录等数据默认推荐用命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值注意用户名的设置一定要提前做好规划在工作中的值一定要提前做好规划而且必须唯一模块该模块应用于用户组的管理命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值注意主机名的设置一定要规范一定要唯一命令可以用来察看系统的数据库中的相关记录经常使用查看用户账号模块模块主要做一些类似于周期性任务相关的任务执行动作常见属性设定天效果结合实现禁用定时任务设定时效果如果是内容是变量如果是内容是定时任务设定分钟效果设定月效果如果有则是变量名如果有则是定时任务名周表示样式注意上面是常用的属性和最好作为强制选项命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值注意的命令一定要规范最好使用绝对路径表示删除表示禁用或启用模块主要是用来收集目标主机的属性信息的常用参数设定的文件路径指定过滤格式可以正则形式注意常用的属性也就上面标红的两个这个模块是通过调用的组件来获取主机是所有属性信息的命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值注意不加的话表示获取目标主机的所有属性信息过滤信息的规则一定要合理的设计这个功能很重要尤其是后期自动化管理的时候模块模块用作对远程主机的机制进行管理常见参数配置文件路径默认在值不为时必选具体设置模块模块用于管理远程主机的挂载常见参数要挂载的设备路径可以是网络地址挂载点取消挂载并删除永久挂载中的配置永久挂载立即生效挂载点不存在会自动创建永久挂载写配置文件但不会立即生效临时取消挂载不改变配置文件重新挂载但不会改变配置文件指定挂载配置文件路径默认设备文件系统挂载选项模块模块用来修改远程主机上的内核参数常见参数参数名称参数值默认调用生效是否保存到文件默认指定保存文件路径默认是否使用校验默认文件管理模块模块模块主要涉及到文件的拷贝动作常见参数创建一个包含时间戳信息的备份文件设置目标的路径强制选项格式与一致设定文件属组信息设定文件属性信息设定文件属主信息源文件的路径平常使用的话推荐使用相对路径敏感文件推荐用绝对路径注意常用的属性也就上面标红的六个备份的时候使用默认的时间戳效果如果源文件是目录的话则必须携带后缀命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值注意源文件路径和目标文件的路径最好格式一致模块该模块的作用于的作用正好相反它是从远程主机拉取文件到本地目录常见参数设定目标文件的地址强制选项允许拼接方式创建文件名设定源文件的地址强制选项注意常用的属性也就上面标红的三个源文件和目标文件的格式最好一致当前的版本只支持抓取远程的单个文件支持只能是本机的目录抓取后的格式目标主机命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值模块模块用于管理远程主机的文件操作远程文件的各种动作常见参数设定文件权限属性设定文件属主指定文件的路径强制选项之前版本可以用和来代替指定文件的源路径设定文件的状态命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值注意在创建相关文件的话如果涉及到父目录必须确保父目录存在否则会失败模块模块主要作用的场景是文件状态查看等常见参数获取文件的路径强制选项命令格式模块在使用的时候标准的写法是目标主机文件路径属性值属性值注意文件的路径一定要正确压缩包模块模块用于将文件从或下载到被管理机节点上常见参数下载文件的支持或协议下载到目标路径绝对路径如果不是目录将每次下载文件如果内容改变替换文件否则只有文件不存在时才下载对目标文件在下载前进行摘要计算只有文件内容正确才会进行文件下载命令格式模块在使用的时候标准的写法是目标主机文件的路径属性值属性值注意文件的路径一定要正确模块模块用于打包压缩保存在被管理节点命令格式模块在使用的时候标准的写法是目标主机属性值属性值模块模块主要用于压缩包的解压功能常见参数默认为当拷贝的文件是从主机复制到远程主机上如果设置为会在远程主机上寻找源文件和功能一样且互斥表示在远程主机不在主机表示文件在主机上源路径可以是主机上或远程主机上的路径如果是远程主机上的路径则需要设置远程主机上的目标路径设置解压缩后的文件权限注意有时候会因为版本的问题导致无法远程解压可以通过方式来解决命令格式模块在使用的时候标准的写法是目标主机属性值属性值编辑模块模块在使用进行替换时经常会遇到需要转义的问题而且在遇到特殊符号进行替换时存在问题无法正常进行替换其实在自身提供了两个模块模块和模块可以方便的进行替换一般在当中去修改某个文件的单行进行替换的时候需要使用模块重要选项参数使用正则表达式匹配对应的行当替换文本时如果有多行文本都能被匹配则只有最后面被匹配到的那行文本才会被替换当删除文本时如果有多行文本都能被匹配这么这些行都会被删除如果想进行多行匹配进行替换需要使用模块命令格式模块在使用的时候标准的写法是目标主机属性值属性值模块模块相较于模块来说更倾向于命令的操作尤其是多行匹配进行替换操作命令格式模块在使用的时候标准的写法是目标主机属性值属性值软件模块模块模块和模块分别用于和系统下的软件安装这两个模块的核心选项基本上都是一样的常见的选项有指定安装软件软件状态安装移除升级到最新版本安装依赖包修复注意安装多个包将包名之间使用逗号隔开即可特殊语法所有包都升级到最新版本其他选项清除本地安装包只删除己卸载的软件的包指定包可以是本地的也可以是网络的卸载依赖包默认仅更新不安装更新索引模块这个模块主要用于配置远程客户端主机上的软件源信息的选项解读具体源具体文件名默认加到中删除新增默认更新源相当于执行模块命令格式模块在使用的时候标准的写法是目标主机属性值属性值注意在安装本地包的时候使用的是属性而且目标主机的本地必须有相应的包在安装本地包的时候有时候可能会因为软件依赖的问题我们可以基于来忽略常见选项指定包名删除安装升级到最新版此选项与选项互斥写具体包名是相当于执行指定下载目录只下载不安装默认仅更新默认指定真实执行的命令默认卸载依赖仅在卸载时生效默认排除某些仓库从指定仓库中安装是否对包进行校验默认是否不对包进行校验默认只更新不安装默认注意模块本身没有直接的选项来刷新缓存但你可以通过执行和命令来达到这一目的模块此模块用来对远程主机上的仓库配置进行管理常见选项描述信息仓库地址是否启用是否启用没有默认值默认跟随中的全局配置路径删除安装默认超时时长默认模块模块的作用就是操作应用服务的主要选项设置开机自启动服务名称强制选项设置服务的状态命令格式模块在使用的时候标准的写法是目标主机属性值属性值信息模块模块模块来收集主机的系统信息这些信息可以直接以变量的形式使用重要选项设定的文件路径指定过滤格式可以正则形式注意这个模块是通过调用的组件来获取主机是所有属性信息的如果主机较多会影响执行速度可以使用来禁止收集信息命令格式模块在使用的时候标准的写法是目标主机属性值属性值属性值注意不加的话表示获取目标主机的所有属性信息过滤信息的规则一定要合理的设计这个功能很重要尤其是后期自动化管理的时候模块模块的功能主要是我们调试环境时候用到的一个模块帮助我们获取一些更详细的信息重要选项打印自定义消息调试变量名称与互斥显示更详细信息注意这个功能在命令行模式下作用不大但是在高级方法中使用的场景作用很大命令格式模块在使用的时候标准的写法是目标主机主机名相关命令是让我们以可交互终端形式执行命令我们可以直接输入该条命令就直接进入到可操作终端命令简介提供了一些常见的应用命令效果如下设置并发数例如切换主机组例如列出当前组主机列表列出所有的内置命令或退出命令是我们接触的一个高级命令而且使用频率仅次于命令工作中的很多高级动作的操作都是通过命令完成的操作的对象其实是一个文件这个文件中定义好了我们想要做的一切事情执行文件就相当于自动化的执行了大量的命令常见的重要参数基本参数检查文件执行效果可以理解为语法检查限制目标主机列出可用主机列出可用标签列出所有任务设定任务执行步骤一步一步的执行用于调试场景语法检查设定标签连接参数设定连接密码提权选项切换角色权限提权用户密码文件中有很多敏感的信息不想丢失安全生产中的某些敏感信息才会使用这种方式命令的作用就是采用安全加密的方式来操作相关文件这个命令主要是罗列的第三方共享资源的专用命令它给我们提供了非常多的模板信息常见的操作命令删除导入查看信息本地初始化安装罗列登录移除搜索启动命令格式列出所有已安装的功能角色注意如果不加表示列出所有如果指定表示只看指定的内容下载功能角色注意他会自动从互联网上下载我们想要的内容包含大量格式的文件下载的内容在功能角色名路径下原因在于的配置文件中的属性决定的基础其实就是一个自动化执行命令的方式是有一个一个的任务组合而成中的指令都是基于的命令演变过来的的专用执行命令是在执行的时候执行效果具有幂等性即一个命令执行多次与执行一次效果一样基础特点由于是一种特殊的描述性语言所以它可读性较好表达能力强扩展性好易于实现整合了多种语言的优势所以它具有通用数据类型执行方式好与脚本语言的交互性好三种常见的数据格式是一种标记语言旨在传输和存储数据主要用于数据交换和配置是一种轻量级的数据交换格式易于人阅读和编写同时也易于机器解析和生成主要用来数据交换和配置不支持注释是一种人类可读的数据序列化标准广泛用于配置文件和数据交换的目标是简洁易读并且具有一致性主要用来配置大小写敏感不支持数据格式特点大小写敏感使用缩进表示层级关系缩进时不允许使用键只允许使用空格缩进的空格数目不重要只要相同层级的元素左侧对齐即可表示注释从这个字符一直到行尾都会被解析器忽略文件内容分隔符简单来说多个文件合并在一个文件中的的分隔符号这属于语法的问题但可能因为的插件原因不推荐将多个写到一个文件中基本样式一它其实就是一个键值对键和值中间使用冒号空格隔开格式键值示例这种基本样式还有一种变种形式就是值的本身就是一个键值对两层之间使用两个空格表示层级关系格式键值键值值示例基本样式二其实这也是一种键值对只不过它的值是一个列表形式特点键和冒号为一行值为下一行键和值有层级关系使用两个空格表示层级关系列表多元素之间是同级关系使用表示格式键值值值值示例常见组件一个中由多个组件组成其中所用到的常见组件类型如下执行的远程主机列表任务集由多个的元素组成的列表实现每个是一个字典内置变量或自定义变量在中调用模板可替换模板文件中的变量并实现一些简单逻辑的文件和结合使用由特定条件触发的操作满足条件方才执行否则不执行标签指定某条任务执行用于选择运行中的部分代码具有幂等性因此会自动跳过没有变化的部分即便如此有些代码为测试其确实没有发生变化的时间依然会非常地长此时如果确信其没有变化就可以通过跳过此些代码片断个完整的代码块功能需最少元素需包括和一个只能包括一个属性由于的配置目的与的主机列表文件目的一致所以他们的编写方法也一样主要有这么几种表示样式单个主机多个主机特定主机注意如果主机数量过多的话我们可以通过属性来限制一次多少台主机来执行任务从而减轻所有任务执行时候的并行压力每次只同时处理的主机每次只同时处理台主机属性指定这些指令以什么样的身份到目标主机执行这个属性就是用户身份虽然简单但是它不仅仅涉及到了登录用户也涉及到了用户在执行命令时候的权限控制即的方式的作用就类似于命令中登录用户登录密码提权密码的效果属性样式由于是由大量的功能任务组成的而这些功能任务有可能在不同的目标主机上以不同的用户什么来运行所以在中基于使用范围和目的的不同有两种表现形式属性文件的主要作用就是实现各种各样的功能每一个功能都是有大量的指令来组成所以对于来说每一个特定的动作都是一个子功能任务所以的功能主体就是大量的列表而且这些任务在执行的时候有一个非常重要的特性幂等的简单来说就是执行多次和执行一次效果一样在执行的时候根据列表中的顺序逐个在的目标主机上执行默认情况下任何一个任务中途发生错误整个任务就自动中断所以默认的在执行的时候有一个隐患在某些条件场景下的逻辑感不强我们后序有相应的属性来解决这种隐患每一个具体的主要有两部分组成名称通过属性来设定该任务中的子命令的名称建议详细一点点动作命令实现特定功能的模块及其使用方法',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-01 20:31:44',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Hexo</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-05T01:52:55.083Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-03-01T12:31:44.000Z" title="更新于 2025-03-01 20:31:44">2025-03-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://lx1me.github.io/2025/06/05/Ansible%E5%9F%BA%E7%A1%80/"><header><h1 id="CrawlerTitle" itemprop="name headline">无题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">John Doe</span><time itemprop="dateCreated datePublished" datetime="2025-06-05T01:52:55.083Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time><time itemprop="dateCreated datePublished" datetime="2025-03-01T12:31:44.000Z" title="更新于 2025-03-01 20:31:44">2025-03-01</time></header><h1 id="Ansible基础"><a href="#Ansible基础" class="headerlink" title="Ansible基础"></a>Ansible基础</h1><p>本笔记介绍了Ansible的基本概念、工作特性、使用场景、架构解析、工作流程以及常用命令和配置文件结构。内容经过优化润色，保留了原始信息并增加了总结和注意事项，使条理更加清晰，重点更突出。所有正文内容均以 <code>ada</code> 代码块呈现，标题和章节采用标准 Markdown 语法，便于一次性复制使用。</p>
<hr>
<h2 id="1-Ansible简介"><a href="#1-Ansible简介" class="headerlink" title="1. Ansible简介"></a>1. Ansible简介</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ansible是一个开源软件，提供配置管理、应用程序部署、自动化云服务管理等项目通用的管理功能。</span><br><span class="line">- 主要运行在类Unix系统上，也支持Microsoft Windows系统。</span><br><span class="line">- 利用特性语言描述各种资源对象，从而管理系统资源。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-Ansible的工作特性"><a href="#2-Ansible的工作特性" class="headerlink" title="2. Ansible的工作特性"></a>2. Ansible的工作特性</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">【基础属性】</span><br><span class="line">- 开发：基于Python语言实现。</span><br><span class="line">- 部署：依靠Python和SSH（agentless）实现简单部署。</span><br><span class="line">- 安全：基于OpenSSH加密方式传输数据，无需代理，不依赖PKI；具有命令执行的幂等性。</span><br><span class="line"></span><br><span class="line">【功能属性】</span><br><span class="line">- 设计：采用插件化方式实现定制功能。</span><br><span class="line">- 关键：三大关键模块：Paramiko、PyYAML、Jinja2。</span><br><span class="line">- 定制：支持自定义功能模块，模块的使用方法类似于专用命令。</span><br><span class="line"></span><br><span class="line">【进阶属性】</span><br><span class="line">- 劣势：由于通信基于SSH，因此受SSH限制较多，尤其在主机量大时存在性能损耗问题。解决方案可采用专用代理或客户端方式以提高效率。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-使用场景"><a href="#3-使用场景" class="headerlink" title="3. 使用场景"></a>3. 使用场景</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Ansible可用于：</span><br><span class="line">- 自动化云服务管理</span><br><span class="line">- 自动化设备管理</span><br><span class="line">- 自动化应用部署</span><br><span class="line">- 自动化配置管理</span><br><span class="line">- 自动化持续交付</span><br><span class="line">- 自动化安全管理</span><br><span class="line"></span><br><span class="line">一句话概括：业务环境的自动化管理。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-架构解析与工作流程"><a href="#4-架构解析与工作流程" class="headerlink" title="4. 架构解析与工作流程"></a>4. 架构解析与工作流程</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">【架构解析】</span><br><span class="line">Ansible采用三层结构：</span><br><span class="line">  <span class="number">1</span>. 用户端</span><br><span class="line">  <span class="number">2</span>. 控制端</span><br><span class="line">  <span class="number">3</span>. 被控端</span><br><span class="line"></span><br><span class="line">【工作流程】</span><br><span class="line">  <span class="number">1</span>. 用户通过命令或playbook向控制端发起请求。</span><br><span class="line">  <span class="number">2</span>. 控制端检查主机列表，验证目标主机是否存在。</span><br><span class="line">  <span class="number">3</span>. 若目标存在，控制端通过连接插件与被控端建立连接。</span><br><span class="line">  <span class="number">4</span>. 控制端根据用户指令和功能模块，指定目标主机执行相应任务。</span><br><span class="line">  <span class="number">5</span>. 被控端执行任务后，将状态结果返回给控制端。</span><br><span class="line">  <span class="number">6</span>. 控制端通过插件实现日志记录、邮件通知等辅助功能。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-Ansible命令执行来源"><a href="#5-Ansible命令执行来源" class="headerlink" title="5. Ansible命令执行来源"></a>5. Ansible命令执行来源</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ansible的命令可通过以下方式执行：</span><br><span class="line">- 系统用户直接在终端中执行Ad<span class="literal">-Hoc</span>命令。</span><br><span class="line">- 在playbook中间接执行：playbook中包含多条Ansible命令，依次执行。</span><br><span class="line">- 通过Web管理界面执行。</span><br><span class="line">- 通过API调用执行：配置API接口，让第三方应用调用执行Ansible命令。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-软件部署与需求"><a href="#6-软件部署与需求" class="headerlink" title="6. 软件部署与需求"></a>6. 软件部署与需求</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">【通用环境需求】</span><br><span class="line">- 服务端与客户端均基于SSH协议通信，须提前配置SSH环境。</span><br><span class="line"></span><br><span class="line">【控制端需求】</span><br><span class="line">- 控制端需运行在类Unix系统上（不支持Windows）。</span><br><span class="line">- 需预先安装Python <span class="number">2.7</span>+或Python <span class="number">3.5</span>+环境。</span><br><span class="line"></span><br><span class="line">【被控端需求】</span><br><span class="line">- 一般功能无需预装Python，但若涉及Python业务，则需配置相应版本：</span><br><span class="line">    - 若被控端Python版本小于<span class="number">2.4</span>，则需安装python<span class="literal">-simplejson</span>。</span><br><span class="line">    - 若启用SELinux，则需安装libselinux<span class="literal">-python</span>。</span><br><span class="line">    - Windows只能作为被控端使用。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-软件环境与常见命令"><a href="#7-软件环境与常见命令" class="headerlink" title="7. 软件环境与常见命令"></a>7. 软件环境与常见命令</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Ansible常见的可执行命令包括：</span><br><span class="line">- /usr/bin/ansible             —— 主命令，用于执行Ad<span class="literal">-Hoc</span>任务。</span><br><span class="line">- /usr/bin/ansible<span class="literal">-config</span>      —— 配置管理命令。</span><br><span class="line">- /usr/bin/ansible<span class="literal">-console</span>     —— 交互式命令行工具。</span><br><span class="line">- /usr/bin/ansible<span class="literal">-doc</span>         —— 模块帮助命令。</span><br><span class="line">- /usr/bin/ansible<span class="literal">-galaxy</span>      —— 扩展命令，用于获取角色模板文件。</span><br><span class="line">- /usr/bin/ansible<span class="literal">-playbook</span>    —— 任务管理工具（主要用于长期规划、大型项目）。</span><br><span class="line">- /usr/bin/ansible<span class="literal">-pull</span>        —— 反模式工作命令。</span><br><span class="line">- /usr/bin/ansible<span class="literal">-vault</span>       —— 文件加密工具。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-Ansible管理方式"><a href="#8-Ansible管理方式" class="headerlink" title="8. Ansible管理方式"></a>8. Ansible管理方式</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主要管理方式：</span><br><span class="line">- Ad<span class="literal">-Hoc</span>：直接使用Ansible命令在远程主机上执行单个任务，适用于临时操作。</span><br><span class="line">- Ansible<span class="literal">-playbook</span>：适用于长期规划、大型项目，需要预先编写剧本（Playbook）。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-命令格式与模块"><a href="#9-命令格式与模块" class="headerlink" title="9. 命令格式与模块"></a>9. 命令格式与模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">【通用命令格式】</span><br><span class="line">  ansible &lt;目标主机&gt; 参数</span><br><span class="line"></span><br><span class="line">【专用格式】</span><br><span class="line">  ansible &lt;目标主机&gt; <span class="literal">-m</span> 模块 <span class="literal">-a</span> 模块参数</span><br><span class="line"></span><br><span class="line">【说明】</span><br><span class="line">- Ad<span class="literal">-Hoc</span>命令允许用户快速在远程主机上执行单条任务，无需编写完整剧本。</span><br><span class="line">- Ansible的主要功能均通过各类插件模块实现，默认模块为command。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="10-主配置文件结构"><a href="#10-主配置文件结构" class="headerlink" title="10. 主配置文件结构"></a>10. 主配置文件结构</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">默认配置文件和目录：</span><br><span class="line">  - /etc/ansible/ansible.cfg：主配置文件，定义Ansible工作特性，可在项目目录下创建独立配置文件，当前目录的ansible.cfg优先级最高。</span><br><span class="line">  - /etc/ansible/hosts：主机清单文件。</span><br><span class="line">  - /etc/ansible/roles/：存放角色的目录。</span><br><span class="line"></span><br><span class="line">配置文件优先级（由高到低）：</span><br><span class="line">  <span class="number">1</span>. ANSIBLE_CONFIG环境变量</span><br><span class="line">  <span class="number">2</span>. 当前目录下的ansible.cfg</span><br><span class="line">  <span class="number">3</span>. 当前用户家目录下的.ansible.cfg</span><br><span class="line">  <span class="number">4</span>. /etc/ansible/ansible.cfg</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="11-模块与命令示例"><a href="#11-模块与命令示例" class="headerlink" title="11. 模块与命令示例"></a>11. 模块与命令示例</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">【command模块】</span><br><span class="line">- 默认模块，无需使用<span class="literal">-m</span>指定，可直接通过 <span class="literal">-a</span> 传入命令参数执行。</span><br><span class="line">- 示例：ansible &lt;目标主机&gt; <span class="literal">-a</span> <span class="string">&quot;命令参数&quot;</span></span><br><span class="line"></span><br><span class="line">【ping模块】</span><br><span class="line">- 用于检测目标主机的连通性。</span><br><span class="line">- 示例：ansible localhost <span class="literal">-m</span> ping</span><br><span class="line"></span><br><span class="line">【ansible<span class="literal">-doc</span>命令】</span><br><span class="line">- 用于查看Ansible模块的帮助信息。</span><br><span class="line">- 示例：ansible<span class="literal">-doc</span> command （完整帮助）或 ansible<span class="literal">-doc</span> command <span class="literal">-s</span> （简要帮助）</span><br><span class="line"></span><br><span class="line">【ansible<span class="literal">-config</span>命令】</span><br><span class="line">- 管理Ansible配置信息：</span><br><span class="line">    - view：查看当前配置</span><br><span class="line">    - dump：查看默认环境变量</span><br><span class="line">    - list：列出详细配置项</span><br><span class="line">    - init：创建初始化配置文件</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="12-主机清单"><a href="#12-主机清单" class="headerlink" title="12. 主机清单"></a>12. 主机清单</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">【主机清单文件】</span><br><span class="line">- 默认文件：/etc/ansible/hosts，可在项目目录下创建独立的hosts文件以区分不同项目。</span><br><span class="line">- 格式：INI风格，组名写在中括号中，同一主机可归属于多个组。</span><br><span class="line">- 主机描述方式：可以使用IP地址或主机名，并可指定非默认SSH端口（用冒号标识）。</span><br><span class="line">  </span><br><span class="line">【主机列表形式】</span><br><span class="line">主机清单的描述方式有两种：主机ip地址和主机名</span><br><span class="line"><span class="comment">## blue<span class="doctag">.example</span>.com</span></span><br><span class="line"><span class="comment">## 192.168.100.1</span></span><br><span class="line">主机列表有两种形式：散列主机列表和主机组列表</span><br><span class="line">散列主机列表            主机组列表              嵌套主机组列表</span><br><span class="line"><span class="comment">## blue<span class="doctag">.example</span>.com   ## [webservers]       ## [server:children]</span></span><br><span class="line"><span class="comment">## 192.168.100.1:9999 ## beta<span class="doctag">.example</span>.org   ## webservers</span></span><br><span class="line"><span class="comment">## 192.168.1.100      ## [webservers]       ## www[1:100]<span class="doctag">.example</span>.com</span></span><br><span class="line">主机列表范围形式可以使用<span class="string">&quot;[起始值:结束值]&quot;</span>样式来表示</span><br><span class="line"><span class="comment">## www[001:006]<span class="doctag">.example</span>.com         主机名方式表示6台目标主机</span></span><br><span class="line"><span class="comment">## 192.168.1.10[0:9]                主机ip地址表示10台目标主机</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">主机组名列表样式:</span><br><span class="line"><span class="number">10.0</span>.<span class="number">0.13</span></span><br><span class="line">[<span class="type">ansible_server</span>]</span><br><span class="line"><span class="number">10.0</span>.<span class="number">0.13</span></span><br><span class="line">组名只能包含了 字母、数字、下划线符号</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">主机做ssh的免密认证:</span><br><span class="line">root@ubuntu24<span class="literal">-13</span>:~<span class="comment"># ssh-keygen</span></span><br><span class="line">root@ubuntu24<span class="literal">-13</span>:~<span class="comment"># ssh-copy-id root@localhost</span></span><br><span class="line">root@ubuntu24<span class="literal">-13</span>:~<span class="comment"># ssh-copy-id root@10.0.0.13</span></span><br><span class="line"> 通信方式：ansible连接目标主机主要是通过ssh协议的方式</span><br><span class="line"> 认证列表：ansible会将连接成功的主机列表信息，记录到ssh的认证列表<span class="string">&quot;.ssh/known_hosts&quot;</span>中</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">ubuntu13</span> ~]<span class="comment"># ansible 10.0.0.13 -a &quot;ls /root&quot;</span></span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;/root/.ssh/id_ed25519&#x27;</span>:</span><br><span class="line">[<span class="type">WARNING</span>]: Platform linux on host <span class="number">10.0</span>.<span class="number">0.13</span> is <span class="keyword">using</span> the discovered Python interpreter at /usr/bin/python3.12, but</span><br><span class="line">future installation of another Python interpreter could change the meaning of that path. See</span><br><span class="line">https://docs.ansible.com/ansible<span class="literal">-core</span>/<span class="number">2.17</span>/reference_appendices/interpreter_discovery.html <span class="keyword">for</span> more information.</span><br><span class="line"><span class="number">10.0</span>.<span class="number">0.13</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="number">1</span>.sh</span><br><span class="line">  这个警告信息来自 Ansible，它指出在目标主机（IP 地址为 <span class="number">10.0</span>.<span class="number">0.13</span>）上，Ansible 使用的是</span><br><span class="line">位于 /usr/bin/python3.<span class="number">12</span> 的 Python 解释器。然而，警告中提到未来如果安装了另一个 Python 解</span><br><span class="line">释器，这个路径的含义可能会改变，这可能会导致 Ansible 脚本执行时出现问题。</span><br><span class="line">为了解决这个问题，我们可以采取指定 Python 解释器路径 的方法来解决</span><br><span class="line">把之前的主机改成:</span><br><span class="line"><span class="number">10.0</span>.<span class="number">0.13</span> ansible_python_interpreter=/usr/bin/python3.<span class="number">12</span></span><br><span class="line">[<span class="type">ansible_server</span>]</span><br><span class="line"><span class="number">10.0</span>.<span class="number">0.13</span> ansible_python_interpreter=/usr/bin/python3.<span class="number">12</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h2 id="13-目标主机匹配"><a href="#13-目标主机匹配" class="headerlink" title="13.目标主机匹配"></a><strong>13.<strong>目标主机匹配</strong></strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">匹配规则;</span><br><span class="line">  对于目标的匹配规则来说，他们的获取方式和表现样式主要有这么几种：</span><br><span class="line">    匹配所有：all</span><br><span class="line">    正则匹配：*(通配符)</span><br><span class="line">    逻辑或：:(并集)，一般用于主机组</span><br><span class="line">    逻辑与：:&amp;(交集)，一般用于主机组</span><br><span class="line">    逻辑非：:!(补集)，一般用于主机组  </span><br></pre></td></tr></table></figure>

<h2 id="14-命令执行流程"><a href="#14-命令执行流程" class="headerlink" title="14.命令执行流程"></a>14.命令执行流程</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">命令执行过程:</span><br><span class="line">  <span class="number">1</span>. 加载ansible配置文件 </span><br><span class="line">    默认加载的是 /etc/ansible/ansible.cfg </span><br><span class="line">  <span class="number">2</span>. 加载指定模块：command</span><br><span class="line">  <span class="number">3</span>. 获取目标主机，与主机列表进行匹配认证    /etc/ansible/hosts</span><br><span class="line">  <span class="number">4</span>. ansible指挥目标主机执行命令</span><br><span class="line">    <span class="number">4.1</span> 控制端生成临时执行文件        ~/.ansible/<span class="built_in">cp</span></span><br><span class="line">    <span class="number">4.2</span> 通过连接插件，与目标主机建立连接     paramiko_ssh</span><br><span class="line">    <span class="number">4.3</span> 通过插件功能将控制端的临时执行文件传输至目标主机的临时目录     ~/.ansible/tmp</span><br><span class="line">      <span class="variable">$HOME</span>/.ansible/tmp/ansible<span class="literal">-tmp-</span>数字/XXX.PY文件</span><br><span class="line">    <span class="number">4.4</span> 指挥目标主机给临时执行文件添加执行权限</span><br><span class="line">    <span class="number">4.5</span> 目标主机执行临时文件并将结果返回给控制主机</span><br><span class="line">    <span class="number">4.6</span> 目标主机删除临时执行py文件，然后断开连接</span><br><span class="line">  <span class="number">5</span>. ansible控制端显示结果，并退出。  </span><br></pre></td></tr></table></figure>

<h1 id="日常命令操作模块"><a href="#日常命令操作模块" class="headerlink" title="日常命令操作模块"></a><strong>日常命令操作模块</strong></h1><h2 id="command模块"><a href="#command模块" class="headerlink" title="command模块"></a><strong>command</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">command： ansible的默认模块，可以运行远程权限所有的shell命令</span><br><span class="line">命令格式:</span><br><span class="line">  Command模块在ansible使用的时候，标准的写法是：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-m</span> command <span class="literal">-a</span> <span class="string">&#x27;可执行命令&#x27;</span></span><br><span class="line">  注意：</span><br><span class="line">    由于ansible的默认模块就是command，所以远程执行命令的时候，一般会忽略<span class="literal">-m</span>选项，效果如下：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-a</span> <span class="string">&#x27;可执行命令&#x27;</span></span><br><span class="line">    可执行命令，就是我们平常在命令行输入的一些执行成功的命令,但是不允许是别名</span><br><span class="line">    command不支持<span class="string">&quot;可执行命令&quot;</span>中的自定义变量和特殊符号(&lt; &gt; | ;&amp;等) </span><br><span class="line">    </span><br><span class="line">argv:           <span class="comment"># 以列表或者字符串格式输入命令</span></span><br><span class="line"><span class="built_in">chdir</span>:             <span class="comment"># 执行命令前，先切换工作路径.</span></span><br><span class="line">creates:         <span class="comment"># 依赖存在对象的命令，若被创建的对象已存在，则不执行该命令</span></span><br><span class="line">free_form:     <span class="comment"># 以自由格式输入参数，这是一个强制的选项</span></span><br><span class="line">removes:            <span class="comment"># 依赖移除对象的命令，若被移除的对象存在，则执行该命令</span></span><br><span class="line">stdin:           <span class="comment"># 设定标准输入作为参数.</span></span><br><span class="line">warn:             <span class="comment"># 警告信息，需要ansible的配置文件的 command_warnings的属性值是yes.</span></span><br><span class="line">command默认情况下，可执行命令中不允许出现命令别名 和管道符等特殊服务号</span><br><span class="line">对于系统默认的环境变量，ansible可以正常执行，但是涉及到一些自定义变量和特殊符号就不行了</span><br></pre></td></tr></table></figure>

<h2 id="shell模块"><a href="#shell模块" class="headerlink" title="shell模块"></a>shell模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">shell：command对于某些特殊的符号命令执行效果不好，专用的shell模块可以满足要求</span><br><span class="line"></span><br><span class="line"><span class="built_in">chdir</span>:               <span class="comment"># 同command</span></span><br><span class="line">creates:               <span class="comment"># 同command</span></span><br><span class="line">executable:           <span class="comment"># 设置执行命令的shell类型</span></span><br><span class="line">free_form:             <span class="comment"># 同command</span></span><br><span class="line">removes:               <span class="comment"># 同command</span></span><br><span class="line">stdin:                 <span class="comment"># 同command</span></span><br><span class="line">warn:                 <span class="comment"># 同command</span></span><br><span class="line">命令格式</span><br><span class="line">  Shell模块在ansible使用的时候，标准的写法是：</span><br><span class="line">  ansible &lt;目标主机&gt; <span class="literal">-m</span> shell <span class="literal">-a</span> <span class="string">&#x27;可执行命令&#x27;</span></span><br><span class="line">  注意：</span><br><span class="line">    可执行命令，就是我们平常在命令行输入的一些执行成功的命令</span><br><span class="line">    shell支持<span class="string">&quot;可执行命令&quot;</span>中的所有效果</span><br><span class="line">    shell在远程执行脚本的时候，必须远程主机存在，否则的话会报错</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h2 id="scripts模块"><a href="#scripts模块" class="headerlink" title="scripts模块"></a>scripts模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scripts：批量的系统命令可以写成一个脚本文件，然后基于scripts的方式来运行，类似scp+shell的功能。</span><br><span class="line">        专门用于执行复杂脚本场景的功能模块</span><br><span class="line">命令格式</span><br><span class="line">script模块在ansible使用的时候，标准的写法是：</span><br><span class="line">ansible &lt;目标主机&gt; <span class="literal">-m</span> script <span class="literal">-a</span> <span class="string">&#x27;可执行命令&#x27;</span></span><br><span class="line">注意：</span><br><span class="line"> script就是不但可以执行目标主机上的脚本文件，而且还能执行目标主机不存在的控制端特有的脚本文件</span><br><span class="line">  对于控制端的脚本文件执行的时候，必须使用executable</span><br><span class="line">  此模块不具有幂等性</span><br><span class="line">  </span><br><span class="line">  命令执行成功的标志 CHANGED </span><br><span class="line">  标准的输出信息在 stdout_lines      </span><br></pre></td></tr></table></figure>

<h1 id="系统管理模块"><a href="#系统管理模块" class="headerlink" title="系统管理模块"></a><strong>系统管理模块</strong></h1><h2 id="hostname模块"><a href="#hostname模块" class="headerlink" title="hostname模块"></a>hostname模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">该模块可以获取主机名相关的信息</span><br><span class="line">hostname模块在ansible使用的时候，标准的写法是：</span><br><span class="line">ansible &lt;目标主机&gt; <span class="literal">-m</span> hostname <span class="literal">-a</span> <span class="string">&#x27;name=主机名&#x27;</span></span><br><span class="line">注意：</span><br><span class="line"> 主机名的设置一定要规范</span><br><span class="line"> 这种方式更改的主机名，是立刻生效而且是永久生效的</span><br></pre></td></tr></table></figure>

<h2 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a><strong>user</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">user模块，主要是用于对远程主机的用户进行干预操作</span><br><span class="line">常见属性</span><br><span class="line">    comment:               <span class="comment"># 用户的描述信息.</span></span><br><span class="line">    <span class="built_in">group</span>:                 <span class="comment"># 设定用户的主组信息</span></span><br><span class="line">    home:                 <span class="comment"># 设置用户家目录.</span></span><br><span class="line">    password:             <span class="comment"># 设置登录密码</span></span><br><span class="line">    shell:                 <span class="comment"># 设定用户的专用shell类型</span></span><br><span class="line">    state:                 <span class="comment"># 设定用户的存活状态</span></span><br><span class="line">    system:               <span class="comment"># 设定用户是否为系统用户</span></span><br><span class="line">    uid:                   <span class="comment"># 设定用户uid</span></span><br><span class="line">    remove <span class="comment"># 设定删除用户及家目录等数据,默认remove=no，推荐用yes</span></span><br><span class="line">命令格式</span><br><span class="line">  hostname模块在ansible使用的时候，标准的写法是：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-m</span> user <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span></span><br><span class="line">  注意：</span><br><span class="line">    用户名的设置一定要提前做好规划</span><br><span class="line">    在工作中，uid的值一定要提前做好规划，而且必须唯一。  </span><br></pre></td></tr></table></figure>

<h2 id="group模块"><a href="#group模块" class="headerlink" title="group模块"></a><strong>group</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">该模块应用于用户组的管理</span><br><span class="line">命令格式</span><br><span class="line">  <span class="built_in">group</span>模块在ansible使用的时候，标准的写法是：</span><br><span class="line">  ansible &lt;目标主机&gt; <span class="literal">-m</span> <span class="built_in">group</span> <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span></span><br><span class="line">    注意：</span><br><span class="line">    主机名的设置一定要规范，gid一定要唯一。  </span><br></pre></td></tr></table></figure>

<h4 id="getent命令可以用来察看系统的数据库中的相关记录-经常使用getent查看用户账号"><a href="#getent命令可以用来察看系统的数据库中的相关记录-经常使用getent查看用户账号" class="headerlink" title="getent命令可以用来察看系统的数据库中的相关记录 经常使用getent查看用户账号"></a>getent命令可以用来察看系统的数据库中的相关记录 经常使用getent查看用户账号</h4><h2 id="cron模块"><a href="#cron模块" class="headerlink" title="cron模块"></a><strong>cron</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cron模块主要做一些，类似于周期性任务相关的任务执行动作</span><br><span class="line">常见属性</span><br><span class="line">      day:               <span class="comment"># 设定天效果 ( 1-31, *, */2, etc )</span></span><br><span class="line">      disabled:         <span class="comment"># 结合`state=present&#x27;实现禁用定时任务.</span></span><br><span class="line">      hour:             <span class="comment">#设定时效果 ( 0-23, *, */2, etc )</span></span><br><span class="line">      job:               <span class="comment"># 如果是env，内容是变量，如果是state=present，内容是定时任务.</span></span><br><span class="line">      minute:           <span class="comment"># 设定分钟效果 ( 0-59, *, */2, etc )</span></span><br><span class="line">      month:             <span class="comment"># 设定月效果 ( 1-12, *, */2, etc )</span></span><br><span class="line">      name:               <span class="comment"># 如果有 env，则是变量名，如果有state=present则是定时任务名.</span></span><br><span class="line">      weekday:           <span class="comment"># 周表示样式 ( 0-6 for Sunday-Saturday, *, etc )</span></span><br><span class="line">注意：</span><br><span class="line"> 上面是常用的属性</span><br><span class="line"> name和job最好作为强制选项</span><br><span class="line"> </span><br><span class="line"> 命令格式</span><br><span class="line">   cron模块在ansible使用的时候，标准的写法是：</span><br><span class="line">   ansible &lt;目标主机&gt; <span class="literal">-m</span> cron <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span></span><br><span class="line">注意：</span><br><span class="line">   job的命令一定要规范，最好使用绝对路径。</span><br><span class="line">   state=absent 表示删除</span><br><span class="line">   disabled=yes|no|true|false 表示禁用或启用  </span><br></pre></td></tr></table></figure>

<h1 id="setup模块"><a href="#setup模块" class="headerlink" title="setup模块"></a><strong>setup</strong>模块</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">setup 主要是用来收集目标主机的属性信息的</span><br><span class="line">常用参数</span><br><span class="line">      fact_path:             <span class="comment"># 设定facts的文件路径</span></span><br><span class="line">      <span class="keyword">filter</span>:               <span class="comment"># 指定过滤格式，可以正则形式.</span></span><br><span class="line">注意：</span><br><span class="line">  常用的属性，也就上面标红的两个。</span><br><span class="line">  setup这个模块是通过调用ansible的facts组件来获取主机是所有属性信息的</span><br><span class="line">命令格式</span><br><span class="line">  setup模块在ansible使用的时候，标准的写法是：</span><br><span class="line">  ansible &lt;目标主机&gt; <span class="literal">-m</span> setup <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span></span><br><span class="line">注意：</span><br><span class="line">  不加 <span class="literal">-a</span>的话，表示获取目标主机的所有属性信息</span><br><span class="line">  过滤信息的规则一定要合理的设计。</span><br><span class="line">  这个功能很重要，尤其是后期自动化管理的时候  </span><br></pre></td></tr></table></figure>

<h2 id="selinux模块"><a href="#selinux模块" class="headerlink" title="selinux模块"></a><strong>selinux</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">selinux 模块用作对远程主机的 selinux 机制进行管理</span><br><span class="line">常见参数</span><br><span class="line">  configfile=/path/file <span class="comment">#selinux 配置文件路径，默认/etc/selinux/config</span></span><br><span class="line">  policy=targeted|minimum|mls <span class="comment">#在state值不为 disabled 时必选</span></span><br><span class="line">  state=disabled|enforcing|permissive <span class="comment">#具体设置</span></span><br></pre></td></tr></table></figure>

<h2 id="mount模块"><a href="#mount模块" class="headerlink" title="mount模块"></a><strong>mount</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mount</span> 模块用于管理远程主机的挂载</span><br><span class="line">常见参数</span><br><span class="line">  src=/path/device <span class="comment">#要挂载的设备路径，可以是网络地址</span></span><br><span class="line">  path=/path/point <span class="comment">#挂载点</span></span><br><span class="line">  state=absent|mounted|present|unmounted|remounted  <span class="comment"># absent 取消挂载,并删除永久挂载中的配置</span></span><br><span class="line">                   <span class="comment"># mounted 永久挂载,立即生效，挂载点不存在会自动创建</span></span><br><span class="line">                   <span class="comment"># present 永久挂载，写配置文件，但不会立即生效</span></span><br><span class="line">                   <span class="comment"># unmounted 临时取消挂载，不改变配置文件</span></span><br><span class="line">                   <span class="comment"># remounted 重新挂载，但不会改变配置文件</span></span><br><span class="line">  fstab=/path/file <span class="comment">#指定挂载配置文件路径，默认 /etc/fstab</span></span><br><span class="line">  fstype=str <span class="comment">#设备文件系统 xfs|ext4|swap|iso9660...</span></span><br><span class="line">  opts=str <span class="comment">#挂载选项</span></span><br></pre></td></tr></table></figure>

<h2 id="sysctl模块"><a href="#sysctl模块" class="headerlink" title="sysctl模块"></a><strong>sysctl</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sysctl 模块用来修改远程主机上的内核参数</span><br><span class="line">常见参数</span><br><span class="line">  name=str <span class="comment">#参数名称</span></span><br><span class="line">  val=str <span class="comment">#参数值</span></span><br><span class="line">  reload=yes|no <span class="comment">#默认yes，调用 /sbin/sysctl -p 生效</span></span><br><span class="line">  state=present|absent <span class="comment">#是否保存到文件，默认present</span></span><br><span class="line">  sysctl_file=/path/file <span class="comment">#指定保存文件路径，默认 /etc/sysctl.conf</span></span><br><span class="line">  sysctl_set=yes|no <span class="comment">#是否使用systctl -w 校验，默认no  </span></span><br></pre></td></tr></table></figure>

<h1 id="文件管理模块"><a href="#文件管理模块" class="headerlink" title="文件管理模块"></a><strong>文件管理模块</strong></h1><h2 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a><strong>copy</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">copy</span>模块主要涉及到文件的拷贝动作</span><br><span class="line">常见参数</span><br><span class="line">   backup:             <span class="comment"># 创建一个包含时间戳信息的备份文件</span></span><br><span class="line">   dest:               <span class="comment"># 设置目标的路径(强制选项)，格式与src一致</span></span><br><span class="line">   <span class="built_in">group</span>:             <span class="comment"># 设定文件属组信息.</span></span><br><span class="line">   mode:             <span class="comment"># 设定文件属性信息.</span></span><br><span class="line">   owner:             <span class="comment"># 设定文件属主信息.</span></span><br><span class="line">   src:               <span class="comment"># 源文件的路径，平常使用的话，推荐使用相对路径，敏感文件推荐用绝对路径</span></span><br><span class="line"> </span><br><span class="line">注意：</span><br><span class="line"> 常用的属性，也就上面标红的六个。</span><br><span class="line"> 备份的时候，使用默认的时间戳效果。</span><br><span class="line"> 如果源文件是目录的话，则必须携带/后缀</span><br><span class="line"> </span><br><span class="line">命令格式</span><br><span class="line">  <span class="built_in">copy</span>模块在ansible使用的时候，标准的写法是：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-m</span> <span class="built_in">copy</span> <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span></span><br><span class="line">注意：</span><br><span class="line">    src源文件路径和dest目标文件的路径，最好格式一致</span><br></pre></td></tr></table></figure>

<h2 id="fetch模块"><a href="#fetch模块" class="headerlink" title="fetch模块"></a><strong>fetch</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">该模块的作用于<span class="built_in">copy</span>的作用正好相反，它是从远程主机拉取文件到本地目录</span><br><span class="line">常见参数</span><br><span class="line">      dest:                 <span class="comment"># 设定目标文件的地址(强制选项)</span></span><br><span class="line">      flat:                 <span class="comment"># 允许拼接方式创建文件名</span></span><br><span class="line">      src:                   <span class="comment"># 设定源文件的地址(强制选项)</span></span><br><span class="line">注意：</span><br><span class="line">   常用的属性，也就上面标红的三个。</span><br><span class="line">   源文件和目标文件的格式最好一致。</span><br><span class="line">   src 当前的版本，只支持抓取远程的单个文件</span><br><span class="line">   dest 支持只能是本机的目录，抓取后的格式： <span class="string">&quot;/dest/&quot;</span> + <span class="string">&quot;目标主机/path/to/src&quot;</span></span><br><span class="line">命令格式</span><br><span class="line">  fetch模块在ansible使用的时候，标准的写法是：</span><br><span class="line">  ansible &lt;目标主机&gt; <span class="literal">-m</span> fetch <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span>  </span><br></pre></td></tr></table></figure>

<h2 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a><strong>file</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">file模块，用于管理远程主机的文件，操作远程文件的各种动作</span><br><span class="line">常见参数</span><br><span class="line">  mode:                 <span class="comment"># 设定文件权限属性.</span></span><br><span class="line">  owner:                 <span class="comment"># 设定文件属主.</span></span><br><span class="line">  path:                 <span class="comment"># 指定文件的路径(强制选项).之前版本可以用name和dest来代替</span></span><br><span class="line">  src:                   <span class="comment"># 指定文件的源路径.</span></span><br><span class="line">  state:                 <span class="comment"># 设定文件的状态，directory、file、absent、touch、link</span></span><br><span class="line">命令格式</span><br><span class="line">  file模块在ansible使用的时候，标准的写法是：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-m</span> file <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span></span><br><span class="line"> </span><br><span class="line">注意：</span><br><span class="line"> 在创建相关文件的话，如果涉及到父目录，必须确保父目录存在，否则会失败  </span><br></pre></td></tr></table></figure>

<h2 id="stat模块"><a href="#stat模块" class="headerlink" title="stat模块"></a><strong>stat</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stat模块主要作用的场景是 文件状态查看等</span><br><span class="line">常见参数</span><br><span class="line">   path:                 <span class="comment"># 获取文件的路径，强制选项</span></span><br><span class="line">命令格式</span><br><span class="line">   stat模块在ansible使用的时候，标准的写法是：</span><br><span class="line">   ansible &lt;目标主机&gt; <span class="literal">-m</span> stat <span class="literal">-a</span> <span class="string">&#x27;path=文件路径 属性1=值1 ... 属性n=值n&#x27;</span></span><br><span class="line">注意：</span><br><span class="line">   文件的路径一定要正确。  </span><br></pre></td></tr></table></figure>

<h1 id="压缩包模块"><a href="#压缩包模块" class="headerlink" title="压缩包模块"></a><strong>压缩包模块</strong></h1><h2 id="Get-url模块"><a href="#Get-url模块" class="headerlink" title="Get_url模块"></a><strong>Get_url</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">用于将文件从http、https或ftp下载到被管理机节点上</span><br><span class="line">常见参数：</span><br><span class="line">   url: 下载文件的URL,支持HTTP，HTTPS或FTP协议</span><br><span class="line">   dest: 下载到目标路径（绝对路径）</span><br><span class="line">   force: 如果yes，dest不是目录，将每次下载文件，如果内容改变，替换文件，否则只有文件不存在时才下载</span><br><span class="line">   checksum:  对目标文件在下载前进行摘要计算，只有文件内容正确，才会进行文件下载</span><br><span class="line">命令格式</span><br><span class="line">   get_url模块在ansible使用的时候，标准的写法是：</span><br><span class="line">   ansible &lt;目标主机&gt; <span class="literal">-m</span> get_url <span class="literal">-a</span> <span class="string">&#x27;url=文件的http路径 属性1=值1 ... 属性n=值n&#x27;</span></span><br><span class="line">注意：</span><br><span class="line">   文件的url路径一定要正确。  </span><br></pre></td></tr></table></figure>

<h2 id="archive模块"><a href="#archive模块" class="headerlink" title="archive模块"></a><strong>archive</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">archive模块，用于打包压缩保存在被管理节点</span><br><span class="line">命令格式</span><br><span class="line">  archive模块在ansible使用的时候，标准的写法是：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-m</span> archive <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 ... 属性n=值n&#x27;</span>  </span><br></pre></td></tr></table></figure>

<h2 id="unarchive模块"><a href="#unarchive模块" class="headerlink" title="unarchive模块"></a><strong>unarchive</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">unarchive模块主要用于压缩包的解压功能</span><br><span class="line">常见参数</span><br><span class="line">   <span class="built_in">copy</span>：默认为yes，</span><br><span class="line">         当<span class="built_in">copy</span>=yes，拷贝的文件是从ansible主机复制到远程主机上，</span><br><span class="line">         如果设置为<span class="built_in">copy</span>=no，会在远程主机上寻找src源文件</span><br><span class="line">   remote_src：和<span class="built_in">copy</span>功能一样且互斥，yes表示在远程主机，不在ansible主机，no表示文件在ansible主机上</span><br><span class="line">   src：源路径，可以是ansible主机上或远程主机上的路径，如果是远程主机上的路径，则需要设置<span class="built_in">copy</span>=no</span><br><span class="line">   dest：远程主机上的目标路径</span><br><span class="line">   mode：设置解压缩后的文件权限</span><br><span class="line">注意：</span><br><span class="line">   有时候，会因为ansible版本的问题，导致无法远程解压，可以通过 <span class="built_in">copy</span> + shell方式来解决</span><br><span class="line">命令格式</span><br><span class="line">  unarchive模块在ansible使用的时候，标准的写法是：</span><br><span class="line">     ansible &lt;目标主机&gt; <span class="literal">-m</span> unarchive <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 ... 属性n=值n&#x27;</span>  </span><br></pre></td></tr></table></figure>

<h1 id="编辑模块"><a href="#编辑模块" class="headerlink" title="编辑模块"></a><strong>编辑模块</strong></h1><h2 id="Lineinfile模块"><a href="#Lineinfile模块" class="headerlink" title="Lineinfile模块"></a><strong>Lineinfile</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   ansible在使用sed进行替换时，经常会遇到需要转义的问题，而且ansible在遇到特殊符号进行替换时，存在问题，无法正常进行替换 。其实在ansible自身提供了两个模块：lineinfile模块和replace模块，可以方便的进行替换</span><br><span class="line">   一般在ansible当中去修改某个文件的单行进行替换的时候需要使用lineinfile模块</span><br><span class="line">重要选项 </span><br><span class="line">   regexp参数：使用正则表达式匹配对应的行，当替换文本时，如果有多行文本都能被匹配，则只有最后面被匹配到的那行文本才会被替换，当删除文本时，如果有多行文本都能被匹配，这么这些行都会被删除。</span><br><span class="line">   如果想进行多行匹配进行替换需要使用replace模块</span><br><span class="line">命令格式</span><br><span class="line">  lineinfile模块在ansible使用的时候，标准的写法是：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-m</span> lineinfile <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 ... 属性n=值n&#x27;</span>  </span><br></pre></td></tr></table></figure>

<h2 id="Replace模块"><a href="#Replace模块" class="headerlink" title="Replace模块"></a><strong>Replace</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Replace模块相较于lineinfile模块来说，更倾向于sed命令的操作，尤其是多行匹配进行替换操作</span><br><span class="line">命令格式</span><br><span class="line">  replace模块在ansible使用的时候，标准的写法是：</span><br><span class="line">    ansible &lt;目标主机&gt; <span class="literal">-m</span> replace <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 ... 属性n=值n&#x27;</span>  </span><br></pre></td></tr></table></figure>

<h1 id="软件模块"><a href="#软件模块" class="headerlink" title="软件模块"></a><strong>软件模块</strong></h1><h2 id="apt模块"><a href="#apt模块" class="headerlink" title="apt模块"></a><strong>apt</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yum模块和apt模块分别用于 centos|redhat 和 ubuntu|debian 系统下的软件安装</span><br><span class="line">  这两个模块的核心选项基本上都是一样的，常见的选项有</span><br><span class="line">    name:                 <span class="comment"># 指定安装软件.</span></span><br><span class="line">    state:                 <span class="comment"># 软件状态：安装(present|installed)</span></span><br><span class="line">                           <span class="comment"># 移除(absent|removed)</span></span><br><span class="line">                           <span class="comment"># 升级到最新版本latest</span></span><br><span class="line">                           <span class="comment"># build-dep 安装依赖包</span></span><br><span class="line">                           <span class="comment"># fix 修复</span></span><br><span class="line"> 注意：</span><br><span class="line"> 安装多个包，将包名之间使用逗号隔开即可</span><br><span class="line"> 特殊语法：所有包都升级到最新版本</span><br><span class="line"> ansible <span class="number">10.0</span>.<span class="number">0.16</span> <span class="literal">-m</span> apt <span class="literal">-a</span> <span class="string">&quot;name=* state=latest&quot;</span></span><br><span class="line"> 其他选项</span><br><span class="line">   autoclean=yes|no <span class="comment">#清除本地安装包，只删除己卸载的软件的 deb包</span></span><br><span class="line">   deb=/path/file.deb <span class="comment">#指定deb包，可以是本地的，也可以是网络的</span></span><br><span class="line">   autoremove=yes|no <span class="comment">#卸载依赖包,默认no</span></span><br><span class="line">   only_upgrade=yes|no <span class="comment">#仅更新，不安装</span></span><br><span class="line">   update_cache=yes|no <span class="comment">#更新索引</span></span><br></pre></td></tr></table></figure>

<h2 id="apt-repository模块1"><a href="#apt-repository模块1" class="headerlink" title="apt_repository模块1"></a><strong>apt_repository</strong>模块1</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">这个模块，主要用于配置远程客户端主机上的软件源信息的</span><br><span class="line">选项解读</span><br><span class="line">  repo=str <span class="comment">#具体源</span></span><br><span class="line">  filename=/path/file <span class="comment">#具体文件名，默认加到 /etc/apt/sources.list 中</span></span><br><span class="line">  state=absent|present <span class="comment">#absent 删除,present 新增，默认 present</span></span><br><span class="line">  update_cache=yes|no <span class="comment">#yes 更新源，相当于执行 apt-get update  </span></span><br></pre></td></tr></table></figure>

<h2 id="yum模块"><a href="#yum模块" class="headerlink" title="yum模块"></a><strong>yum</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">命令格式</span><br><span class="line">  yum|apt模块在ansible使用的时候，标准的写法是：</span><br><span class="line">  ansible &lt;目标主机&gt; <span class="literal">-m</span> yum|apt <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 ... 属性n=值n&#x27;</span></span><br><span class="line"> </span><br><span class="line">注意：</span><br><span class="line">   在安装本地包的时候，使用的是name属性，而且目标主机的本地必须有相应的包</span><br><span class="line">   在安装本地包的时候，有时候可能会因为软件依赖的问题，我们可以基于disable_gpg_check=yes来忽略</span><br><span class="line"> 常见选项</span><br><span class="line">   name=packagename <span class="comment">#指定包名 name1,name2</span></span><br><span class="line">   state=absent|installed|latest|present|removed <span class="comment">#absent|removed 删除,installed|present 安装,latest 升级到最新版</span></span><br><span class="line">    list=packagename|installed|updates|available|repos <span class="comment">#此选项与name选项互斥，</span></span><br><span class="line">                               <span class="comment">#写具体包名是相当于执行 yum list --showduplicates packagename</span></span><br><span class="line">    download_dir=/path <span class="comment">#指定下载目录</span></span><br><span class="line">    download_only=yes|no <span class="comment">#只下载不安装，默认 no</span></span><br><span class="line">    update_only=yes|no <span class="comment">#yes 仅更新,默认no</span></span><br><span class="line">    use_backend=auto|yum|yum4|dnf <span class="comment">#指定真实执行的命令,默认 auto</span></span><br><span class="line">    autoremove=yes|no <span class="comment">#卸载依赖，仅在卸载时生效，默认no</span></span><br><span class="line">    disablerepo=repoid <span class="comment">#排除某些仓库 repoid1,repoid2</span></span><br><span class="line">    enablerepo=repoid <span class="comment">#从指定仓库中安装 repoid1,repoid2</span></span><br><span class="line">    validate_certs=yes|no <span class="comment">#是否对包进行校验，默认yes</span></span><br><span class="line">    disable_gpg_check=yes|no <span class="comment">#是否不对包进行校验，默认no</span></span><br><span class="line">    update_only=yes|no <span class="comment">#只更新不安装,默认no </span></span><br><span class="line">    注意：yum 模块本身没有直接的选项来刷新缓存，但你可以通过执行 yum clean all 和 yum makecache 命令来达到这一目的。</span><br></pre></td></tr></table></figure>

<h2 id="yum-repository模块"><a href="#yum-repository模块" class="headerlink" title="yum_repository模块"></a><strong>yum_repository</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">此模块用来对远程主机上的 yum 仓库配置进行管理</span><br><span class="line">常见选项</span><br><span class="line">name=repoid <span class="comment">#repoid</span></span><br><span class="line">description=desc <span class="comment">#描述信息</span></span><br><span class="line">baseurl=url <span class="comment">#仓库地址</span></span><br><span class="line">enabled=yes|no <span class="comment">#是否启用</span></span><br><span class="line">gpgcheck=yes|no <span class="comment">#是否启用gpgcheck，没有默认值，默认跟随 /etc/yum.conf 中的全局配置</span></span><br><span class="line">gpgkey=/path/key <span class="comment">#gpgkey路径</span></span><br><span class="line">state=absent|present <span class="comment">#absent删除， present安装，默认present</span></span><br><span class="line">timeout=<span class="number">30</span> <span class="comment">#超时时长，默认30s</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="service模块"><a href="#service模块" class="headerlink" title="service模块"></a><strong>service</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">service模块的作用就是操作应用服务的</span><br><span class="line">主要选项</span><br><span class="line">    enabled:               <span class="comment"># 设置开机自启动</span></span><br><span class="line">    name:                 <span class="comment"># 服务名称(强制选项).</span></span><br><span class="line">    state:                 <span class="comment"># 设置服务的状态started|stopped|restarted|reloaded</span></span><br><span class="line">命令格式</span><br><span class="line">  service模块在ansible使用的时候，标准的写法是：</span><br><span class="line">  ansible &lt;目标主机&gt; <span class="literal">-m</span> service <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 ... 属性n=值n&#x27;</span>  </span><br></pre></td></tr></table></figure>

<h1 id="信息模块"><a href="#信息模块" class="headerlink" title="信息模块"></a><strong>信息模块</strong></h1><h2 id="Setup模块"><a href="#Setup模块" class="headerlink" title="Setup模块"></a><strong>Setup</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">setup 模块来收集主机的系统信息，这些 facts 信息可以直接以变量的形式使用</span><br><span class="line">重要选项</span><br><span class="line">    fact_path:             <span class="comment"># 设定facts的文件路径</span></span><br><span class="line">    <span class="keyword">filter</span>:               <span class="comment"># 指定过滤格式，可以正则形式.</span></span><br><span class="line">注意</span><br><span class="line">   setup这个模块是通过调用ansible的facts组件来获取主机是所有属性信息的</span><br><span class="line">   如果主机较多，会影响执行速度，可以使用`gather_facts: no` 来禁止 Ansible 收集 facts 信息</span><br><span class="line"> 命令格式</span><br><span class="line">   setup模块在ansible使用的时候，标准的写法是：</span><br><span class="line">          ansible &lt;目标主机&gt; <span class="literal">-m</span> setup <span class="literal">-a</span> <span class="string">&#x27;属性1=值1 属性2=值2 ... 属性n=值n&#x27;</span></span><br><span class="line">注意：</span><br><span class="line"> 不加 <span class="literal">-a</span>的话，表示获取目标主机的所有属性信息</span><br><span class="line"> 过滤信息的规则一定要合理的设计。</span><br><span class="line"> 这个功能很重要，尤其是后期自动化管理的时候      </span><br></pre></td></tr></table></figure>

<h2 id="debug模块"><a href="#debug模块" class="headerlink" title="debug模块"></a><strong>debug</strong>模块</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">debug模块的功能主要是我们调试环境时候，用到的一个模块，帮助我们获取一些更详细的信息</span><br><span class="line">重要选项</span><br><span class="line">    msg:                   <span class="comment"># 打印自定义消息</span></span><br><span class="line">    var:                   <span class="comment"># 调试变量名称，与msg互斥</span></span><br><span class="line">    verbosity:             <span class="comment"># 显示更详细信息</span></span><br><span class="line">注意：</span><br><span class="line"> 这个功能在命令行模式下作用不大，但是在高级playbook方法中使用的场景作用很大。</span><br><span class="line"> 命令格式</span><br><span class="line"> debug模块在ansible使用的时候，标准的写法是：</span><br><span class="line">     ansible &lt;目标主机&gt; <span class="literal">-m</span> debug <span class="literal">-a</span> <span class="string">&#x27;name=主机名&#x27;</span>  </span><br></pre></td></tr></table></figure>

<h1 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a><strong>相关命令</strong></h1><h2 id="ansible-console"><a href="#ansible-console" class="headerlink" title="ansible-console"></a><strong>ansible-console</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ansible<span class="literal">-console</span>是让我们以可交互终端形式执行命令，我们可以直接输入该条命令就直接进入到可操作终端.</span><br><span class="line">命令简介</span><br><span class="line">  console提供了一些常见的应用命令，效果如下：</span><br><span class="line">    设置并发数：forks n 例如：forks <span class="number">10</span></span><br><span class="line">    切换主机组：<span class="built_in">cd</span> group_name 例如：<span class="built_in">cd</span> web</span><br><span class="line">    列出当前组主机列表：list</span><br><span class="line">    列出所有的内置命令：?或help</span><br><span class="line">    退出：<span class="keyword">exit</span> </span><br></pre></td></tr></table></figure>

<h2 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible-playbook"></a><strong>ansible-playbook</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ansible<span class="literal">-playbook</span>命令是我们接触ansible的一个高级命令，而且使用频率仅次于ansible命令，工作中的很多高级动作的操作，都是通过ansible<span class="literal">-playbook</span>命令完成的，ansible<span class="literal">-playbook</span>操作的对象其实是一个yaml文件，这个文件中定义好了我们想要做的一切事情，ansible<span class="literal">-playbook</span> 执行 yaml 文件就相当于自动化的执行了大量的ansible命令。</span><br><span class="line">常见的重要参数</span><br><span class="line">     Options: <span class="comment"># 基本参数</span></span><br><span class="line">       <span class="literal">-C</span>, <span class="literal">--check</span>         <span class="comment"># 检查文件执行效果，可以理解为语法检查</span></span><br><span class="line">       <span class="literal">-l</span> SUBSET, <span class="literal">--limit</span>=SUBSET <span class="comment"># 限制目标主机</span></span><br><span class="line">       <span class="literal">--list-hosts</span>         <span class="comment"># 列出可用主机</span></span><br><span class="line">       <span class="literal">--list-tags</span>           <span class="comment"># 列出可用标签</span></span><br><span class="line">       <span class="literal">--list-tasks</span>         <span class="comment"># 列出所有任务</span></span><br><span class="line">       <span class="literal">--step</span>               <span class="comment"># 设定任务执行步骤，一步一步的执行，用于调试场景</span></span><br><span class="line">       <span class="literal">--syntax-check</span> <span class="comment"># 语法检查</span></span><br><span class="line">       <span class="literal">-t</span> TAGS, <span class="literal">--tags</span>=TAGS <span class="comment"># 设定标签</span></span><br><span class="line">       Connection Options: <span class="comment"># 连接参数</span></span><br><span class="line">       <span class="literal">-k</span>, <span class="literal">--ask-pass</span>     <span class="comment"># 设定连接密码</span></span><br><span class="line">   </span><br><span class="line">       Privilege Escalation Options: <span class="comment"># 提权选项</span></span><br><span class="line">       <span class="literal">-b</span>, <span class="literal">--become</span>       <span class="comment"># 切换角色权限</span></span><br><span class="line">       <span class="literal">-K</span>, <span class="literal">--ask-become-pass</span> <span class="comment"># 提权用户密码</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-vault"><a href="#ansible-vault" class="headerlink" title="ansible-vault"></a><strong>ansible-vault</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yaml文件中有很多敏感的信息，不想丢失安全</span><br><span class="line">生产中的某些敏感信息才会使用这种方式。</span><br><span class="line">ansible<span class="literal">-vault</span> 命令的作用就是采用安全加密的方式来操作相关文件。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ansible-galaxy"><a href="#ansible-galaxy" class="headerlink" title="ansible-galaxy"></a><strong>ansible-galaxy</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">这个命令主要是罗列ansible的第三方共享资源的专用命令，它给我们提供了非常多的模板信息</span><br><span class="line">常见的操作命令</span><br><span class="line">    delete 删除 import 导入 info 查看信息 init 本地初始化 install 安装</span><br><span class="line">    list 罗列 login 登录 remove 移除 search 搜索 setup 启动</span><br><span class="line">命令格式</span><br><span class="line">  列出所有已安装的galaxy 功能角色</span><br><span class="line">    ansible<span class="literal">-galaxy</span> list &lt;username.role_name&gt;</span><br><span class="line"> 注意：</span><br><span class="line"> 如果不加username.role_name表示列出所有，如果指定表示只看指定的内容 </span><br><span class="line">  </span><br><span class="line">  下载 galaxy 功能角色</span><br><span class="line">    ansible<span class="literal">-galaxy</span> install username.role_name</span><br><span class="line"> 注意：</span><br><span class="line"> 他会自动从互联网上下载我们想要的内容，包含大量yaml格式的文件</span><br><span class="line"> 下载的内容在 <span class="string">&quot;/etc/ansible/roles/功能角色名&quot;</span> 路径下，</span><br><span class="line"> 原因在于ansible的配置文件中的<span class="string">&quot;roles_path&quot;</span>属性决定的</span><br></pre></td></tr></table></figure>

<h1 id="Playbook"><a href="#Playbook" class="headerlink" title="Playbook"></a><strong>Playbook</strong></h1><h2 id="playbook基础"><a href="#playbook基础" class="headerlink" title="playbook基础"></a><strong>playbook</strong>基础</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">playbook 其实就是一个自动化执行ansible命令的方式</span><br><span class="line"></span><br><span class="line">playbook 是有一个一个的任务组合而成</span><br><span class="line">playbook 中的指令都是基于ansible的命令演变过来的</span><br><span class="line">playbook 的专用执行命令是 ansible<span class="literal">-playbook</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="C:\Users\lx1me\AppData\Roaming\Typora\typora-user-images\image-20250301174321436.png" alt="image-20250301174321436"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible在执行playbook的时候，执行效果具有幂等性(即一个命令执行多次与执行一次效果一样)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="YAML基础"><a href="#YAML基础" class="headerlink" title="YAML基础"></a><strong>YAML</strong>基础</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">YAML特点</span><br><span class="line">  YAML由于是一种特殊的描述性语言，所以它</span><br><span class="line">   可读性较好、表达能力强、扩展性好，易于实现</span><br><span class="line">  YAML整合了多种语言的优势,所以它</span><br><span class="line">   具有通用数据类型、执行方式好、与脚本语言的交互性好  </span><br></pre></td></tr></table></figure>

<h2 id="三种常见的数据格式"><a href="#三种常见的数据格式" class="headerlink" title="三种常见的数据格式"></a><strong>三种常见的数据格式</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">XML (eXtensible Markup Language)</span><br><span class="line">  XML 是一种标记语言，旨在传输和存储数据。主要用于数据交换和配置</span><br><span class="line">JSON (JavaScript Object Notation)</span><br><span class="line">  JSON 是一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成。主要用来数据交换和配置，不支持注释。</span><br><span class="line">YAML (YAML Ain<span class="string">&#x27;t Markup Language)</span></span><br><span class="line"><span class="string">  YAML 是一种人类可读的数据序列化标准，广泛用于配置文件和数据交换。YAML 的目标是简洁、易读，并且具有一致性。主要用来配置，大小写敏感，不支持tab。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">数据格式特点</span></span><br><span class="line"><span class="string">  大小写敏感</span></span><br><span class="line"><span class="string">  使用缩进表示层级关系</span></span><br><span class="line"><span class="string">  缩进时不允许使用Tab键，只允许使用空格。</span></span><br><span class="line"><span class="string">  缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</span></span><br><span class="line"><span class="string">    # 表示注释，从这个字符一直到行尾，都会被解析器忽略</span></span><br><span class="line"><span class="string">  文件内容分隔符&quot;---&quot;</span></span><br><span class="line"><span class="string">    简单来说，多个文件合并在一个文件中的的分隔符号，这属于yaml语法的问题，</span></span><br><span class="line"><span class="string">    但可能因为ansible的插件原因，不推荐将多个ansible playbook写到一个yaml文件中  </span></span><br><span class="line"><span class="string">  </span></span><br></pre></td></tr></table></figure>

<h2 id="基本样式一：YAML-Maps"><a href="#基本样式一：YAML-Maps" class="headerlink" title="基本样式一：YAML Maps"></a>基本样式一：YAML Maps</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">它其实就是一个键值对，键和值中间使用<span class="string">&quot;冒号+空格&quot;</span>隔开。</span><br><span class="line">        格式：</span><br><span class="line">            键: 值</span><br><span class="line">        示例：</span><br><span class="line">            app: mysql</span><br><span class="line">这种基本样式，还有一种变种形式，就是值的本身就是一个键值对，两层之间使用两个空格表示层级关系</span><br><span class="line"> 格式：</span><br><span class="line">            键:</span><br><span class="line">              值-键：值-值</span><br><span class="line"> 示例：</span><br><span class="line">            metadata:</span><br><span class="line">              name: mysql</span><br></pre></td></tr></table></figure>

<h2 id="基本样式二：YAML-Lists"><a href="#基本样式二：YAML-Lists" class="headerlink" title="基本样式二：YAML Lists"></a>基本样式二：YAML Lists</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">其实这也是一种键值对，只不过它的值是一个列表形式。</span><br><span class="line">    特点：</span><br><span class="line">        <span class="number">1</span>、键和冒号为一行，值为下一行</span><br><span class="line">        <span class="number">2</span>、键和值有层级关系，使用两个空格表示层级关系</span><br><span class="line">        <span class="number">3</span>、列表多元素之间是同级关系，使用 - 表示</span><br><span class="line">格式：</span><br><span class="line">        键:</span><br><span class="line">          - 值a1</span><br><span class="line">            值a2</span><br><span class="line">          - 值b1</span><br><span class="line">            值b2</span><br><span class="line">          ... </span><br><span class="line">    示例：</span><br><span class="line">        args:</span><br><span class="line">         - <span class="built_in">sleep</span></span><br><span class="line">         - <span class="string">&quot;1000&quot;</span></span><br><span class="line">         - message</span><br><span class="line">         </span><br></pre></td></tr></table></figure>

<h2 id="playbook常见组件"><a href="#playbook常见组件" class="headerlink" title="playbook常见组件"></a><strong>playbook</strong>常见组件</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">一个playbook 中由多个组件组成,其中所用到的常见组件类型如下:</span><br><span class="line"> Hosts   执行的远程主机列表</span><br><span class="line"> Tasks   任务集,由多个task的元素组成的列表实现,每个task是一个字典</span><br><span class="line"> Variables 内置变量或自定义变量在playbook中调用</span><br><span class="line"> Templates  模板，可替换模板文件中的变量并实现一些简单逻辑的文件</span><br><span class="line"> Handlers  和 notify 结合使用，由特定条件触发的操作，满足条件方才执行，否则不执行</span><br><span class="line"> tags 标签  指定某条任务执行，用于选择运行playbook中的部分代码。ansible具有幂等性，因此会</span><br><span class="line">自动跳过没有变化的部分，即便如此，有些代码为测试其确实没有发生变化的时间依然会非常地长。此时，如果确信其没有变化，就可以通过tags跳过此些代码片断</span><br><span class="line"></span><br><span class="line">个完整的代码块功能需最少元素需包括 name 和 task,一个name只能包括一个task</span><br></pre></td></tr></table></figure>

<h2 id="hosts属性"><a href="#hosts属性" class="headerlink" title="hosts属性"></a><strong>hosts</strong>属性</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">由于hosts的配置目的与ansible的主机列表文件目的一致，所以他们的编写方法也一样，主要有这么几种表</span><br><span class="line">示样式：</span><br><span class="line">单个主机：</span><br><span class="line">    <span class="literal">-hosts</span>: <span class="number">192.168</span>.<span class="number">8.14</span></span><br><span class="line">    <span class="literal">-hosts</span>: master.ansible.com</span><br><span class="line">多个主机</span><br><span class="line">    <span class="literal">-hosts</span>: <span class="number">192.168</span>.<span class="number">8</span>.*</span><br><span class="line">    <span class="literal">-hosts</span>: *.ansible.com</span><br><span class="line">特定主机</span><br><span class="line">    <span class="literal">-hosts</span>: web:mysql</span><br><span class="line">    <span class="literal">-hosts</span>: web:&amp;mysql</span><br><span class="line">    <span class="literal">-hosts</span>: web:!mysql</span><br><span class="line">注意:</span><br><span class="line">    如果主机数量过多的话，我们可以通过 serial 属性来限制一次多少台主机来执行任务，从而减轻所有任务执行时候的并行压力。</span><br><span class="line"> serial: <span class="string">&quot;20%&quot;</span>   <span class="comment"># 每次只同时处理20%的主机</span></span><br><span class="line"> serial: <span class="string">&quot;2&quot;</span>   <span class="comment"># 每次只同时处理2台主机</span></span><br></pre></td></tr></table></figure>

<h2 id="remote-user属性"><a href="#remote-user属性" class="headerlink" title="remote_user属性"></a><strong>remote_user</strong>属性</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">指定这些ansible指令以什么样的身份到目标主机执行，这个属性就是remote_user。</span><br><span class="line">   用户身份虽然简单，但是它不仅仅涉及到了登录用户，也涉及到了用户在执行命令时候的权限控制，即sudo的方式</span><br><span class="line">   remote_user 的作用就类似于ansible命令中 <span class="string">&quot;-u 登录用户&quot;</span> + <span class="string">&quot;-k 登录密码&quot;</span> + <span class="string">&quot;-K 提权密码&quot;</span> 的效果</span><br><span class="line">属性样式</span><br><span class="line">  由于playbook是由大量的功能任务组成的，而这些功能任务有可能在不同的目标主机上以不同的用户什么来运行，所以在playbook中remote_user基于使用范围和目的的不同，有两种表现形式。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tasks属性"><a href="#tasks属性" class="headerlink" title="tasks属性"></a><strong>tasks</strong>属性</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> playbook文件的主要作用就是实现各种各样的功能，每一个功能都是有大量的ansible指令来组成，所</span><br><span class="line">以对于playbook来说，每一个特定的ansible动作都是一个子功能任务，所以playbook的功能主体就是大</span><br><span class="line">量的task列表。而且这些任务在执行的时候有一个非常重要的特性:幂等的。简单来说就是执行多次和执行一</span><br><span class="line">次效果一样。</span><br><span class="line"> playbook在执行的时候，根据task列表中的顺序，逐个在hosts的目标主机上执行，默认情况下，任何一个任务中途发生错误，整个任务就自动中断。所以默认的task在执行的时候有一个隐患：在某些条件场景下的逻辑感不强。</span><br><span class="line">我们后序有相应的属性来解决这种隐患：notify+handler</span><br><span class="line"></span><br><span class="line">每一个具体的task主要有两部分组成：</span><br><span class="line"> task名称：通过name属性来设定该任务中的子命令的名称，建议详细一点点</span><br><span class="line"> task动作：ansible命令实现特定功能的模块及其使用方法</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">John Doe</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://lx1me.github.io/2025/06/05/Ansible%E5%9F%BA%E7%A1%80/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://lx1me.github.io/2025/06/05/Ansible%E5%9F%BA%E7%A1%80/')">Hexo</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://lx1me.github.io/2025/06/05/Ansible%E5%9F%BA%E7%A1%80/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Hexo&amp;url=https://lx1me.github.io/2025/06/05/Ansible%E5%9F%BA%E7%A1%80/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lx1me.github.io" target="_blank">Hexo</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2025/06/05/DevOps%20%E4%B9%8B%20CICD%20%E6%9C%8D%E5%8A%A1%E5%99%A8%20Jenkins/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Ansible%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Ansible基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Ansible%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1. Ansible简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Ansible%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">2. Ansible的工作特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.</span> <span class="toc-text">3. 使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">4. 架构解析与工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Ansible%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%9D%A5%E6%BA%90"><span class="toc-number">1.5.</span> <span class="toc-text">5. Ansible命令执行来源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%BD%AF%E4%BB%B6%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%9C%80%E6%B1%82"><span class="toc-number">1.6.</span> <span class="toc-text">6. 软件部署与需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E8%BD%AF%E4%BB%B6%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="toc-number">1.7.</span> <span class="toc-text">7. 软件环境与常见命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Ansible%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">8. Ansible管理方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F%E4%B8%8E%E6%A8%A1%E5%9D%97"><span class="toc-number">1.9.</span> <span class="toc-text">9. 命令格式与模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.</span> <span class="toc-text">10. 主配置文件结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%91%BD%E4%BB%A4%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.</span> <span class="toc-text">11. 模块与命令示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E4%B8%BB%E6%9C%BA%E6%B8%85%E5%8D%95"><span class="toc-number">1.12.</span> <span class="toc-text">12. 主机清单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E5%8C%B9%E9%85%8D"><span class="toc-number">1.13.</span> <span class="toc-text">13.目标主机匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.14.</span> <span class="toc-text">14.命令执行流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%B8%B8%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%9D%97"><span class="toc-number">2.</span> <span class="toc-text">日常命令操作模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#command%E6%A8%A1%E5%9D%97"><span class="toc-number">2.1.</span> <span class="toc-text">command模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell%E6%A8%A1%E5%9D%97"><span class="toc-number">2.2.</span> <span class="toc-text">shell模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scripts%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.</span> <span class="toc-text">scripts模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">系统管理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hostname%E6%A8%A1%E5%9D%97"><span class="toc-number">3.1.</span> <span class="toc-text">hostname模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#user%E6%A8%A1%E5%9D%97"><span class="toc-number">3.2.</span> <span class="toc-text">user模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group%E6%A8%A1%E5%9D%97"><span class="toc-number">3.3.</span> <span class="toc-text">group模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#getent%E5%91%BD%E4%BB%A4%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E5%AF%9F%E7%9C%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E8%AE%B0%E5%BD%95-%E7%BB%8F%E5%B8%B8%E4%BD%BF%E7%94%A8getent%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E8%B4%A6%E5%8F%B7"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">getent命令可以用来察看系统的数据库中的相关记录 经常使用getent查看用户账号</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cron%E6%A8%A1%E5%9D%97"><span class="toc-number">3.4.</span> <span class="toc-text">cron模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#setup%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">setup模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#selinux%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text">selinux模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mount%E6%A8%A1%E5%9D%97"><span class="toc-number">4.2.</span> <span class="toc-text">mount模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sysctl%E6%A8%A1%E5%9D%97"><span class="toc-number">4.3.</span> <span class="toc-text">sysctl模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">5.</span> <span class="toc-text">文件管理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#copy%E6%A8%A1%E5%9D%97"><span class="toc-number">5.1.</span> <span class="toc-text">copy模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fetch%E6%A8%A1%E5%9D%97"><span class="toc-number">5.2.</span> <span class="toc-text">fetch模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file%E6%A8%A1%E5%9D%97"><span class="toc-number">5.3.</span> <span class="toc-text">file模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stat%E6%A8%A1%E5%9D%97"><span class="toc-number">5.4.</span> <span class="toc-text">stat模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E5%8C%85%E6%A8%A1%E5%9D%97"><span class="toc-number">6.</span> <span class="toc-text">压缩包模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Get-url%E6%A8%A1%E5%9D%97"><span class="toc-number">6.1.</span> <span class="toc-text">Get_url模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#archive%E6%A8%A1%E5%9D%97"><span class="toc-number">6.2.</span> <span class="toc-text">archive模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unarchive%E6%A8%A1%E5%9D%97"><span class="toc-number">6.3.</span> <span class="toc-text">unarchive模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%A8%A1%E5%9D%97"><span class="toc-number">7.</span> <span class="toc-text">编辑模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lineinfile%E6%A8%A1%E5%9D%97"><span class="toc-number">7.1.</span> <span class="toc-text">Lineinfile模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Replace%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.</span> <span class="toc-text">Replace模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%9D%97"><span class="toc-number">8.</span> <span class="toc-text">软件模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#apt%E6%A8%A1%E5%9D%97"><span class="toc-number">8.1.</span> <span class="toc-text">apt模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#apt-repository%E6%A8%A1%E5%9D%971"><span class="toc-number">8.2.</span> <span class="toc-text">apt_repository模块1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yum%E6%A8%A1%E5%9D%97"><span class="toc-number">8.3.</span> <span class="toc-text">yum模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yum-repository%E6%A8%A1%E5%9D%97"><span class="toc-number">8.4.</span> <span class="toc-text">yum_repository模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#service%E6%A8%A1%E5%9D%97"><span class="toc-number">8.5.</span> <span class="toc-text">service模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%A8%A1%E5%9D%97"><span class="toc-number">9.</span> <span class="toc-text">信息模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup%E6%A8%A1%E5%9D%97"><span class="toc-number">9.1.</span> <span class="toc-text">Setup模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debug%E6%A8%A1%E5%9D%97"><span class="toc-number">9.2.</span> <span class="toc-text">debug模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">10.</span> <span class="toc-text">相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ansible-console"><span class="toc-number">10.1.</span> <span class="toc-text">ansible-console</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ansible-playbook"><span class="toc-number">10.2.</span> <span class="toc-text">ansible-playbook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ansible-vault"><span class="toc-number">10.3.</span> <span class="toc-text">ansible-vault</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ansible-galaxy"><span class="toc-number">10.4.</span> <span class="toc-text">ansible-galaxy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Playbook"><span class="toc-number">11.</span> <span class="toc-text">Playbook</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#playbook%E5%9F%BA%E7%A1%80"><span class="toc-number">11.1.</span> <span class="toc-text">playbook基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML%E5%9F%BA%E7%A1%80"><span class="toc-number">11.2.</span> <span class="toc-text">YAML基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">11.3.</span> <span class="toc-text">三种常见的数据格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A0%B7%E5%BC%8F%E4%B8%80%EF%BC%9AYAML-Maps"><span class="toc-number">11.4.</span> <span class="toc-text">基本样式一：YAML Maps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A0%B7%E5%BC%8F%E4%BA%8C%EF%BC%9AYAML-Lists"><span class="toc-number">11.5.</span> <span class="toc-text">基本样式二：YAML Lists</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#playbook%E5%B8%B8%E8%A7%81%E7%BB%84%E4%BB%B6"><span class="toc-number">11.6.</span> <span class="toc-text">playbook常见组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hosts%E5%B1%9E%E6%80%A7"><span class="toc-number">11.7.</span> <span class="toc-text">hosts属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#remote-user%E5%B1%9E%E6%80%A7"><span class="toc-number">11.8.</span> <span class="toc-text">remote_user属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tasks%E5%B1%9E%E6%80%A7"><span class="toc-number">11.9.</span> <span class="toc-text">tasks属性</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.118Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%20Docker/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.113Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%20ZABBIX/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.113Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%A0%A1%E5%9E%92%E6%9C%BA%20JumpServer/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.108Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%B0%83%E5%BA%A6%E5%99%A8LVS/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.108Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="John Doe" target="_blank">John Doe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 John Doe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>