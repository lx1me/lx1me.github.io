<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Hexo | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Hexo"><meta name="application-name" content="Hexo"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Hexo"><meta property="og:url" content="https://lx1me.github.io/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93-1/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="MySQL 数据库-1MySQL 架构和性能优化123456789101112131415161718192021222324252627282930313233343536373839mysql的查询过程1 客户端发送查询请求：  用户通过客户端（如命令行工具、数据库管理工具等）发送SQL查询语句"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="John Doe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="MySQL 数据库-1MySQL 架构和性能优化123456789101112131415161718192021222324252627282930313233343536373839mysql的查询过程1 客户端发送查询请求：  用户通过客户端（如命令行工具、数据库管理工具等）发送SQL查询语句"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://lx1me.github.io/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93-1/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: John Doe","link":"链接: ","source":"来源: Hexo","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Hexo',
  title: 'Hexo',
  postAI: '',
  pageFillDescription: 'MySQL 数据库-1, MySQL 架构和性能优化, mysql组件, 连接器, 线程池, SQL语句解析, 其它组件, 存储引擎(默认是InnoDB), MyISAM 存储引擎, InnoDB 存储引擎, 表锁和行锁, 表空间, 表结构与数据存储的分离, InnoDB 存储引擎中的 MVCC, InnoDB 中的 MVCC, 数据库服务配置, 数据库基本信息, 环境变量, 1 服务器系统变量, 查看变量, 会话变量修改, 服务器状态变量, 服务器变量 sql_mode, INDEX 索引, 索引介绍, 索引数据结构, **B-**树, **B+**树索引, B+树和B-树的主要区别, 查看索引, 创建索引, 删除索引, 并发控制, 锁, 锁命令, 全局锁, 事务基础, 事务管理, 自动提交能力, 查看事务, 死锁, 事务隔离, 事务并发中可能出现的问题, MVCC和事务的隔离级别, 日志管理, MySQL的日志类型, 事务日志, 事务日志性能优化, 错误日志, 通用日志, 慢查询日志, 二进制日志, 查看二进制文件数据库架构和性能优化的查询过程客户端发送查询请求用户通过客户端如命令行工具数据库管理工具等发送查询语句到服务器服务器接收并处理连接服务器通过连接器接收客户端的连接请求并进行身份认证和权限验证如果验证成功服务器为客户端分配一个独立的线程来处理后续的查询请求查询缓存后已移除该功能在早期版本的中服务器会检查查询缓存看是否存在已经执行过且结果未过期的相同查询如果缓存命中则直接返回缓存的结果跳过后续的解析和执行步骤注意由于查询缓存的局限性如更新操作会导致缓存失效在及以后版本中查询缓存功能已被移除原因维护成本高在早期版本中每当数据发生变化如执行插入更新或删除操作时相关的查询缓存就可能会失效需要进行清理或更新随着数据量和更新频率的增加这种维护操作的开销会变得非常大甚至可能超过查询缓存带来的性能提升缓存命中率不稳定查询缓存的效果依赖于查询的重复性和数据的稳定性在实际应用中如果查询语句变化多样或者数据更新频繁查询缓存的命中率可能会很低导致查询缓存占用了内存资源却不能有效提高性能内存管理复杂管理查询缓存需要额外的内存空间并且要解决内存碎片等问题在高并发环境下内存管理的复杂性会进一步增加可能导致性能问题和内存泄漏等风险解析服务器对接收到的查询语句进行解析生成解析树或称为语法树解析过程包括词法分析和语法分析确保语句的语法正确并识别出语句中的关键字表名列名等随后进行语义分析检查表名列名是否存在以及用户是否有相应的权限查询优化优化器对解析后的查询语句进行优化生成最优的执行计划优化过程包括选择最佳的索引确定表的连接顺序重写查询等以提高查询效率优化器会计算不同执行计划的预测成本值并选择成本最小的计划作为最终执行计划执行计划生成根据优化器生成的执行计划服务器确定具体的查询执行步骤执行计划包括选择索引读取顺序数据过滤排序聚合等操作执行查询并返回结果执行器根据执行计划调用存储引擎的来执行查询操作存储引擎负责具体的数据存储和读取操作根据执行计划读取数据并返回给执行器执行器对读取到的数据进行处理如过滤排序聚合等然后生成结果集最终服务器将处理后的结果集返回给客户端组件连接器连接器对等客户端工具或编程语言的对的连接功能进行管理连接器是端的第一个模块每种编程语言软件几乎都有适合自己的连接器软件插件线程池的线程池是一种重要的技术旨在提高数据库的性能和资源利用效率作用的线程池在提高资源利用效率减少线程创建和销毁的开销实现负载均衡以及提高并发处理能力等方面发挥着重要作用它是数据库性能优化的重要手段之一特别适用于高并发环境下的数据库访问同时线程池还可以与连接池结合使用以进一步提高数据库性能资源复用线程池复用线程减少了线程的创建和销毁开销连接池复用连接减少了连接的创建和销毁开销提高并发处理能力线程池可以处理多个并发请求而不需要为每个请求创建新的线程连接池可以管理多个数据库连接确保在高并发情况下应用程序能够迅速获取到数据库连接优化资源分配通过线程池和连接池的结合使用可以更合理地分配系统资源例如可以根据系统的负载情况动态调整线程池和连接池的大小以平衡性能和资源利用率简化管理线程池和连接池都提供了对资源和连接的管理功能使得开发人员可以更加专注于业务逻辑的实现而不需要过多关注底层资源的管理语句解析语句接口完整的命令的解释器对语句进行检查是否有错误并且进行词法分析语法分析识别出具体操作对象参数等查询解析器解析器会根据己经检查过的语句生成一个数据结构一般是树形结构我们称其为解析树在这个过程中也会校验当前连接的客户端是否有权限操作库和表等在中语法树更准确地说是抽象语法树是对语句进行解析后得到的一种树形结构表示当你向服务器发送一条语句时服务器首先会对该语句进行词法分析和语法分析词法分析将语句拆分成一个个的词法单元例如关键字标识符操作符等语法分析则根据的语法规则将这些词法单元组织成一个树形结构即抽象语法树查询优化器优化器可以通过分析抽象语法树来理解语句的逻辑结构和语义从而确定如何以最有效的方式执行查询例如它可以识别出哪些条件可以提前过滤数据哪些表连接可以采用更高效的算法根据解析器生成的解析树中的各个节点生成不同的执行计划然后决定一个最优的执行顺序路径里面使用基于开销的优化器哪种计划开销最小就用哪种从而保证在使用最少的开销的情况下返回正确的结果语句在执行的时候会先判断一下连接用户是否对特定表具有查询的权限然后根据表的引擎定义去使用这个引擎提供的接口其它组件存储引擎存储引擎其实就是对于数据库文件的一种存取机制如何实现存储数据如何为存储的数据建立索引以及如何更新查询数据等技术实现的方法数据库中的数据本质上来讲是存在于硬盘上的物理文件不同的存储引擎有不同的特性实际上就是使用不同的技术和方式来管理文件中的数据存储引擎将存于硬盘上的物理文件加载到内存中然后再有上面的语句对内存中的数据进行各种各样的操作存储引擎默认是中的数据用各种不同的技术存储在文件或者内存中这些技术中的每一种技术都使用不同的存储机制索引技巧锁定水平并且最终提供广泛的不同的功能和能力此种技术称为存储引擎支持多种存储引擎其中目前应用最广泛的是和两种存储引擎决定了数据如何存储在磁盘上以及如何被访问它提供了数据的存储机制索引技巧锁定水平并最终提供不同的功能和能力具体的数据库里面的输入如何存储到物理的数据文件里面是由存储引擎来实现的在之后默认存储引擎是在之前是默认情况下存储引擎有个默认情况下存储引擎数量有个存储引擎存储引擎特点不支持事务表级锁定读写相互阻塞写入不能读读时不能写只缓存索引不支持外键约束不支持聚簇索引支持全文索引读取数据较快占用资源较少不支持多版本并发控制机制高并发崩溃恢复性较差前默认的数据库引擎存储引擎适用场景读多写少的业务或者只读的业务不需要事务支持的业务比如转账充值这种业务就不行并发访问低的业务对数据一致性要求不高的业务表较小可以接受长时间进行修复操作存储引擎相关文件表格式定义表格式定义开始但是目前依然在使用数据文件索引文件存储引擎存储引擎特点支持事务适合处理大量短期事务行级锁定读写阻塞与事务隔离级别相关可缓存数据和索引支持聚簇索引崩溃恢复性更好支持高并发支持表分区支持表空间从后支持全文索引从开始为默认的数据库引擎存储引擎适用场景数据读写都较为频繁的业务需要事务支持的业务对并发要求较高的业务对数据一致性要求较高的业务存储引擎相关文件表格式定义数据和索引文件中常见的存储引擎特性说明特性存储引擎存储引擎存储引擎存储引擎存储引擎树索引备份时间点恢复集群模式聚集索引数据压缩数据缓存数据加密外键全文检索地理空间数据类型地理空间数据索引索引索引缓存锁颗粒度多版本并发控制数据同步表空间上限树索引事务元数据静态更新表锁和行锁锁是计算机协调多个进程或线程并发访问某一资源的机制在关系型数据库中按数据操作的颗粒度划分分为表锁行锁和页锁表锁表锁是中锁定粒度最大的一种锁表示对当前操作的整张表加锁哪怕只操作表里面的一行数据它实现简单消耗资源少被大部份存储引擎支持存储引擎使用表锁表级锁定分为表共享读锁共享锁与表独占写锁排他锁表锁的特点是开销小加锁快不会出现死锁锁定颗粒度大发生锁冲突的概率高并发性差行锁行锁是中锁定粒度最小的一种锁表示只对当前操作的行加锁行锁能大大减少数据库操作的冲突其加锁粒度最小但加锁的开销也最大行级锁分为共享锁和排他锁存储引擎默认采用行锁行锁的特点是开销大加锁慢会出现死锁锁定颗粒度最小发生锁冲突的概率最低并发性好表空间共享表空间共享表空间是指表结构文件单独放在以数据命名的文件夹中格式为所有引擎表的数据都放在一个文件中独立表空间独立表空间是指用独立文件存放每个表的表结构和数据及索引在独立表空间的前提下共享表空间中的文件还是存在独立表空间文件只存储该表的数据索引和插入缓冲的等信息其它信息还是存放在共享表空间中表结构与数据存储的分离表结构存储在数据库中对于使用引擎的表其表结构文件是以为后缀的并且单独存放在以数据库名命名的文件夹中比如有一个数据库叫里面有一张表那么的表结构文件就会存放在这个文件夹下这种存储方式使得表结构的管理和维护相对独立便于数据库系统快速定位和读取表的定义信息比如表的列结构索引结构等数据存储所有引擎表的数据并没有跟随各自的表结构文件分散存储而是集中存放在等这样的文件中这意味着不同表的数据在物理存储上是聚合在一起的形成了一个共享的空间来存储所有相关表的数据存储引擎中的多版本并发控制是一种实现并发控制的方法一般用在数据库管理系统中实现对数据库的并发访问使得大部份支持行锁的事务引擎不再单纯的使用行锁来进行数据库的并发控制而是把数据库的行锁与数据版本结合起来只需要很小的开销就可以实现非锁定读从而大大提高了数据库系统的并发性能中的在中使用存储引擎的表在创建时系统会自动给表加上两个版本控制字段这是两个隐藏列这两个字段不显示在表结构中其中一个字段保存了行的创建时间一个保存了行的过期时间或删除时间实际上存储的并不是时间而是版本号为了方便理解我们认为记录的是时间当客户端要执行语句时会根据当前的时间与数据表中记录的时间进行比较确保不会让客户端得到非法数据数据库服务配置数据库基本信息数据库类似于中的库主要负责存储数据库的用户权限设置关键字等自己需要使用的控制和管理信息数据库数据库主要用于收集数据库服务器性能参数库里表的存储引擎均为用户不能创建存储引擎为的表环境变量服务器系统变量服务器系统变量分为全局变量和会话变量两种全局变量表示可以影响到所有连接终端所有会话会话变量只影响当前会话全局变量在服务器启动时被初始化并且对所有会话都有效全局变量的值可以被所有会话共享并且可以通过语句进行修改需要适当的权限一些全局变量定义了服务器的属性特征例如用于限制服务器的最大连接数会话变量是特定于当前会话连接的变量每个会话都有自己的一组会话变量这些变量的值在会话期间是有效的并且对其他会话是不可见的会话变量可以通过语句或不带或关键字默认为会话级别语句进行修改一些会话变量可以复制全局变量的值作为其初始值但之后可以在会话中独立修改全局变量数量相对较少因为它们定义了服务器的整体行为和属性会话变量数量可能更多因为每个会话都可以有自己的会话变量集合并且这些变量可以在会话期间被动态创建和修改查看变量查看全局所有变量查看指定变量查看全局变量会话变量修改修改会话变量仅对当前会话有影响只读变量无法修改变量无法实现永久保存重启服务后会被重置服务器状态变量服务器状态变量分全局和会话两种其中许多变量有双重域既是全局变量也是会话变量有相同的名字状态变量用于保存运行中的统计数据的变量只读不可修改服务器变量是服务器选项也是变量其值会影响语句执行的工作模式服务器变量是数据库中的一个重要系统变量它用于控制如何处理语句和数据校验可以看作是一组约束和规范用于确保数据的准确性完整性和一致性通过设置不同的选项可以改变的执行和处理方式以适应不同的需求或标准作用控制数据的插入更新和删除操作确保数据符合表的定义对插入数据进行校验如日期格式数据类型长度等改变对于字符串和数字之间的隐式转换规则使的语法更加严格符合标准提高的安全性避免一些潜在的安全漏洞索引索引介绍索引是帮助高效获取数据的数据结构索引是一种特殊的数据库结构由数据库表中一列或多列组合而成主要用于加快数据的查询和检索速度它类似于书籍的目录或字典的音序表可以帮助数据库系统快速定位和获取所需的数据从而提高查询性能优点大大加快数据的检索速度创建唯一性索引保证数据库表中每一行数据的唯一性加速表和表之间的连接在使用分组和排序子句进行数据检索时可以显著减少查询中分组和排序的时间缺点索引需要占物理空间当对表中的数据进行增加删除和修改的时候索引也要动态的维护降低了数据的维护速度索引数据结构索引的算法和结构主要取决于存储引擎对于存储引擎最常用的索引结构是树索引树索引具有以下特点所有数据都会出现在叶子节点叶子节点形成一个单向链表便于范围搜索和排序非叶子节点仅起到索引数据作用不存储实际数据只存储索引使得树的层级更低性能更高索引结构树树的分类无序树树中任意节点的子结点之间没有顺序关系有序树树中任意节点的子结点之间有顺序关系二叉树每个节点最多含有两个子树的树称为二叉树二叉查找树首先它是一颗二叉树若左子树不空则左子树上所有结点的值均小于它的根结点的值若右子树不空则右子树上所有结点的值均大于它的根结点的值左右子树也分别为二叉排序树满二叉树叶节点除外的所有节点均含有两个子树的树被称为满二叉树完全二叉树如果一颗二叉树除去最后一层节点为满二叉树且最后一层的结点依次从左到右分布霍夫曼树带权路径最短的二叉树红黑树红黑树是一颗特殊的二叉查找树每个节点都是黑色或者红色根节点叶子节点是黑色如果一个节点是红色的则它的子节点必须是黑色的平衡二叉树一棵空树或它的左右两个子树的高度差的绝对值不超过并且左右两个子树都是一棵平衡二叉树树树读作树中间的横线是连字符不是减号树将一个节点的大小设置为每个数据页也可以称为块的大小一般是并且树中是将数据和索引放在一起的以减少次数加快查询速度一个节点能放多少数据通常取决于一条数据占用的空间大小树索引树是树的变体也是一棵多路搜索树普遍使用树来实现索引树和树的主要区别树内部节点是保存数据的而树内部节点是不保存数据的只作索引作用它的叶子节点才保存数据树相邻的叶子节点之间是通过链表指针连起来的树却不是查找过程中树在找到具体的数值以后就结束而树则需要通过索引找到叶子结点中的数据才结束树中任何一个关键字出现且只出现在一个结点中而树可以出现多次树和树的主要区别树内部节点是保存数据的而树内部节点是不保存数据的只作索引作用它的叶子节点才保存数据树相邻的叶子节点之间是通过链表指针连起来的树却不是查找过程中树在找到具体的数值以后就结束而树则需要通过索引找到叶子结点中的数据才结束树中任何一个关键字出现且只出现在一个结点中而树可以出现多次查看索引创建索引语法示例创建一个索引该索引包含列的完整值这意味着无论列中的字符串有多长整个字符串都会被包含在索引中创建一个前缀索引该索引仅包含列的前个字符这意味着索引是基于列值的前个字符创建的删除索引并发控制所谓并发控制是指多个进程同时读写一条数据的时候数据库对此情况的处理方式锁机制读锁共享锁也称为锁只读不可写包括当前事务多个读互不阻塞写锁独占锁排它锁也称为锁写锁会阻塞其它事务不包括当前事务的读和写锁锁是加在索引上的不是加在数据上的类别详情存储引擎锁粒度锁的实现锁类型说明表级锁存储引擎自行实现该引擎的锁策略和锁粒度隐式锁由存储引擎自动施加锁表级锁自行实现在程序中或命令行下用命令显式实现显式锁用户手动请求行级锁存储引擎自行实现该引擎的锁策略和锁粒度隐式锁由存储引擎自动施加锁行级锁自行实现在程序中或命令行下用命令显式实现显式锁用户手动请求锁命令加读锁释放读锁加写锁释放写锁连接或进程只能释放其自身施加的锁一个只能为自己获取锁和释放锁不能为其他获取锁也不能释放由其他保持的锁全局锁关闭正在打开的表清除查询缓存通常在备份前加全局读锁关闭所有打开的表强制关闭所有正在使用的表并刷新查询缓存和预准备语句缓存不会刷新脏块关闭所有打开的表并使用全局读锁锁定所有数据库的所有表不会刷新脏块也不阻塞日志表写入例如查询日志慢日志等操作指定表刷新脏块脏块也称为脏页当内存数据页和磁盘数据页上的内容不一致时我们称这个内存页为脏页事务基础事务事务是一组具有原子性的语句或者说一个独立单元可以理解为一个事务对应的是一组完整的业务这个业务有一条或多条语句组成所谓原子性是指这一组业务中的语句不可分割所以要么全部语句都执行成功事务也就执行成功只要有一条语句执行失败则整个事务都要回滚到事务开始前事务特性原子性原子性又称不可分割性一个事务中的所有操作要么全部完成要么全部不完成不会结束在中间某个环节事务在执行过程中发生错误会被回滚到事务开始前的状态就像这个事务从来没有执行过一样一致性事务的执行结果必须是符合预期的这表示在事务中进行的数据读写完全符合所有的预设规则这包含资料的精确度串联性以及后续数据库可以自发性地完成预定的工作隔离性隔离性又称独立性允许多个事务并发同时进行写操作隔离性用于实现事务的并发控制防止多个事务并发执行时的交叉执行而导致的数据不一致事务的隔离分为不同的级别包括读未提交读提交可重复读串行化持久性事务执行成功后其对于数据的修改会永久保存于数据库中事务管理显式启动事务语法解读结束事务提交执行回滚自动提交能力对于来说每一个对于数据的增删改的动作都是一个事务为什么我们操作过数据之后另外的终端可以立刻生效呢原因是对于这种操作启用了自动提交的能力默认开始自动提交关闭自动提交查看事务查看当前正在进行的事务死锁死锁是指两个或两个以上的进程在执行过程中因争夺资源而造成的一种互相等待的现象若无外力作用它们都将无法推进下去此时称系统处于死锁状态或系统产生了死锁这些永远在互相等的进程称为死锁进程死锁语法解析查看状态可以查看锁信息查看正在进行中的事务查看锁及以后使用此语句查看锁查看锁等待及以后使用此语句查看锁等待事务隔离的事务隔离级别一共有四个分别是读未提交读已提交可重复读以及可串行化的隔离级别的作用就是让事务之间互相隔离互不影响这样可以保证事务的一致性读未提交在读未提交隔离级别下事务可以读取到事务修改过但未提交的数据可能发生脏读不可重复读和幻读问题一般很少使用此隔离级别简单来说你没有提交的时候我就看到你修改的数据读已提交在读已提交隔离级别下事务只能在事务修改过并且已提交后才能读取到事务修改的数据读已提交隔离级别解决了脏读的问题但可能发生不可重复读和幻读问题一般很少使用此隔离级别简单来说你提交后我才可以看到你修改的数据可重复读在可重复读隔离级别下事务只能在事务修改过数据并提交后自己也提交事务后才能读取到事务修改的数据可重复读隔离级别解决了脏读和不可重复读的问题但可能发生幻读问题简单来说你提交了我也提交了我才有能力读自己的数据可串行化可串行化又称序列化各种问题脏读不可重复读幻读都不会发生通过加锁实现读锁和写锁简单来说咱们俩谁先开始另外一个人处于等待状态谁后开始的问题以上四种隔离级别从上往下隔离强度逐渐增强性能逐渐变差需要消耗的的资源越多所以并不是隔离强度越高越好采用哪种隔离级别要根据系统需求权衡决定中默认的隔离级别是可重复读事务并发中可能出现的问题脏读只在读未提交隔离级别才会出现脏读指的是读到了其他事务未提交的数据未提交意味着这些数据可能会回滚也就是可能最终不会存到数据库中也就是不存在的数据读到了并不一定最终存在的数据这就是脏读不可重复读在读未提交和读已提交隔离级别都可能会出现不可重复读指的是在同一事务内不同的时刻读到的同一批数据可能是不一样的可能会受到其他事务的影响比如其他事务改了这批数据并提交了幻读在读未提交读已提交可重复读隔离级别都可能会出现一个事务先根据某些条件查询出一些记录之后另一个事务又向表中插入了符合这些条件的记录原先的事务再次按照该条件查询时能把另一个事务插入的记录也读出来和事务的隔离级别多版本并发控制机制只在和两个隔离级别下工作日志管理的日志类型支持丰富的日志类型主要有以下六种日志类型说明事务日志记录等支持事务的存储引擎执行事务时产生的日志其写入类型为顺序错误日志记录服务的启动运行或停止服务时出现的问题通常也会记录通用日志又称查询日志记录建立的客户端连接和执行的语句慢查询日志记录所有执行时间超过的所有查询或不使用索引的查询有助于定位性能问题二进制日志记录所有更改数据的语句主要用于复制和即时点恢复中继日志从主服务器的二进制日志文件中复制而来的事件并保存为的日志文件与二进制日志几乎相同事务日志查看日志信息中的相关变量确认日志所处的位置事务日志性能优化包含日志缓冲和磁盘上的日志文件两部分每执行新一条语句都会先将日志记录在中然后再根据不同的配置项使用不同的规则将中的数据落盘写入到但是是用户空间的数据无法直接写入磁盘中间必须经过操作系统缓冲区因此从到实际上会先写再调用将其刷人入到中错误日志中错误日志中记录的主要内容启动和关闭过程中输出的事件信息运行中产生的错误信息运行一个时产生的日志信息在主从复制架构中的从服务器上启动从服务器线程时产生的信息通用日志通用日志通用日志又称通用查询日志用来记录对数据库的所有操作包括启动和关闭服务更新语句和查询语句等默认情况下通用查询日志功能是关闭的可以通过配置开启此日志并决定将日志存储到文件或数据表中如果选择记录到数据表中则具体的表是慢查询日志慢查询日志用来记录在中执行时间超过指定时间的查询语句通过慢查询日志可以查找出哪些查询语句的执行效率低以便进行优化慢查询日志默认不开启环境查看开启慢查询日志二进制日志二进制日志也可叫作变更日志是中非常重要的日志主要用于记录数据库的变化情况即语句的和语句但不包含查询操作语句因为查询语句并不会改变数据库中的数据如果数据库意外停止可以通过二进制日志文件来查看用户执行了哪些操作对数据库服务器文件做了哪些修改然后根据二进制日志文件中的记录来恢复数据库服务器事务日志和二进制区别事务日志可以看作是在线日志二进制日志可以看作是离线日志事务日志记录事务执行的过程包括提交和未提交二进制日志记录只记提交的过程事务日志只支持存储引擎二进制支持和存储引擎事务日志的容量是的大小会滚动覆盖式更新二进制的容量大小没有限制二进制日志记录三种格式基于语句的记录模式日志中会记录原生执行的语句对于某些函数或变量不会替换基于行的记录模式会将语句中的变量和函数进行替换后再记录混合记录模式在此模式下会根据具体的语句来分析采用哪种模式记录日志查看二进制文件查看当前服务的二进制文件列表查看正在使用的二进制文件',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-17 19:18:59',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Hexo</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-05T01:52:55.088Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-03-17T11:18:59.625Z" title="更新于 2025-03-17 19:18:59">2025-03-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://lx1me.github.io/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93-1/"><header><h1 id="CrawlerTitle" itemprop="name headline">无题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">John Doe</span><time itemprop="dateCreated datePublished" datetime="2025-06-05T01:52:55.088Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time><time itemprop="dateCreated datePublished" datetime="2025-03-17T11:18:59.625Z" title="更新于 2025-03-17 19:18:59">2025-03-17</time></header><h1 id="MySQL-数据库-1"><a href="#MySQL-数据库-1" class="headerlink" title="MySQL 数据库-1"></a><strong>MySQL</strong> <strong>数据库</strong>-1</h1><h2 id="MySQL-架构和性能优化"><a href="#MySQL-架构和性能优化" class="headerlink" title="MySQL 架构和性能优化"></a><strong>MySQL</strong> <strong>架构和性能优化</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mysql的查询过程</span><br><span class="line"><span class="number">1</span> 客户端发送查询请求：</span><br><span class="line">  用户通过客户端（如命令行工具、数据库管理工具等）发送SQL查询语句到MySQL服务器。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 服务器接收并处理连接：</span><br><span class="line">  MySQL服务器通过连接器接收客户端的连接请求，并进行身份认证和权限验证。</span><br><span class="line">  如果验证成功，服务器为客户端分配一个独立的线程来处理后续的查询请求。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 查询缓存（MySQL <span class="number">8.0</span>后已移除该功能）：</span><br><span class="line">  在早期版本的MySQL中，服务器会检查查询缓存，看是否存在已经执行过且结果未过期的相同查询。</span><br><span class="line">  如果缓存命中，则直接返回缓存的结果，跳过后续的解析和执行步骤。</span><br><span class="line">注意：</span><br><span class="line">  由于查询缓存的局限性（如更新操作会导致缓存失效），在MySQL <span class="number">8.0</span>及以后版本中，查询缓存功能已被移除。</span><br><span class="line"> 原因：</span><br><span class="line">  维护成本高：在早期版本中，每当数据发生变化，如执行插入、更新或删除操作时，相关的查询缓存就可能会失效，需要进行清理或更新。随着数据量和更新频率的增加，这种维护操作的开销会变得非常大，甚至可能超过查询缓存带来的性能提升。</span><br><span class="line">  缓存命中率不稳定：查询缓存的效果依赖于查询的重复性和数据的稳定性。在实际应用中，如果查询语句变化多样，或者数据更新频繁，查询缓存的命中率可能会很低，导致查询缓存占用了内存资源却不能有效提高性能。</span><br><span class="line">  内存管理复杂：管理查询缓存需要额外的内存空间，并且要解决内存碎片等问题。在高并发环境下，内存管理的复杂性会进一步增加，可能导致性能问题和内存泄漏等风险。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> SQL解析：</span><br><span class="line">    服务器对接收到的SQL查询语句进行解析，生成解析树（或称为语法树）。</span><br><span class="line">    解析过程包括词法分析和语法分析，确保SQL语句的语法正确，并识别出SQL语句中的关键字、表名、列名等。</span><br><span class="line">    随后进行语义分析，检查表名、列名是否存在，以及用户是否有相应的权限。</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> 查询优化optimizer：</span><br><span class="line">    优化器对解析后的查询语句进行优化，生成最优的执行计划。</span><br><span class="line">    优化过程包括选择最佳的索引、确定表的连接顺序、重写查询等，以提高查询效率。</span><br><span class="line">    优化器会计算不同执行计划的预测成本值，并选择成本最小的计划作为最终执行计划。</span><br><span class="line"></span><br><span class="line"><span class="number">6</span> 执行计划生成：</span><br><span class="line">    根据优化器生成的执行计划，服务器确定具体的查询执行步骤。</span><br><span class="line">    执行计划包括选择索引、读取顺序、数据过滤、排序、聚合等操作。</span><br><span class="line"></span><br><span class="line"><span class="number">7</span> 执行查询并返回结果：</span><br><span class="line">    执行器根据执行计划调用存储引擎的API来执行查询操作。</span><br><span class="line">    存储引擎负责具体的数据存储和读取操作，根据执行计划读取数据并返回给执行器。</span><br><span class="line">    执行器对读取到的数据进行处理（如过滤、排序、聚合等），然后生成结果集。</span><br><span class="line"></span><br><span class="line">最终，服务器将处理后的结果集返回给客户端。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="mysql组件"><a href="#mysql组件" class="headerlink" title="mysql组件"></a>mysql组件</h2><h4 id="连接器"><a href="#连接器" class="headerlink" title="连接器"></a>连接器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">连接器对  Native，JDBC，ODBC，NET，PHP，Perl，Python，Ruby，Cobol 等客户端工具或编程语言的 API 对MySQL 的连接功能进行管理。连接器是 Server 端的第一个模块。</span><br><span class="line"> 每种编程语言软件几乎都有适合自己的连接器软件插件。</span><br></pre></td></tr></table></figure>



<h4 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MySQL的线程池是一种重要的技术，旨在提高数据库的性能和资源利用效率。</span><br><span class="line">作用</span><br><span class="line">MySQL的线程池在提高资源利用效率、减少线程创建和销毁的开销、实现负载均衡以及提高并发处理能力等方面发挥着重要作用。它是数据库性能优化的重要手段之一，特别适用于高并发环境下的数据库访问。同时，线程池还可以与连接池结合使用，以进一步提高数据库性能。</span><br><span class="line"><span class="number">1</span> 资源复用：</span><br><span class="line">    线程池复用线程，减少了线程的创建和销毁开销。</span><br><span class="line">    连接池复用连接，减少了连接的创建和销毁开销。</span><br><span class="line"><span class="number">2</span> 提高并发处理能力：</span><br><span class="line">    线程池可以处理多个并发请求，而不需要为每个请求创建新的线程。</span><br><span class="line">    连接池可以管理多个数据库连接，确保在高并发情况下，应用程序能够迅速获取到数据库连接。</span><br><span class="line"><span class="number">3</span> 优化资源分配：</span><br><span class="line"> 通过线程池和连接池的结合使用，可以更合理地分配系统资源。例如，可以根据系统的负载情况动态调整线程池和连接池的大小，以平衡性能和资源利用率。</span><br><span class="line"><span class="number">4</span> 简化管理：</span><br><span class="line"> 线程池和连接池都提供了对资源和连接的管理功能，使得开发人员可以更加专注于业务逻辑的实现，而不需要过多关注底层资源的管理。</span><br></pre></td></tr></table></figure>

<h4 id="SQL语句解析"><a href="#SQL语句解析" class="headerlink" title="SQL语句解析"></a>SQL语句解析</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL Interface：SQL 语句接口</span><br><span class="line">  完整的 sql 命令的解释器，对 SQL 语句进行检查，是否有错误，并且进行词法分析，语法分析，识别出具体操作，对象，参数等。 </span><br><span class="line"></span><br><span class="line">Parser：查询解析器 </span><br><span class="line">  解析器会根据己经检查过的SQL语句生成一个数据结构，一般是树形结构，我们称其为解析树。在这个过程中也会校验当前连接的客户端是否有权限操作库和表等。</span><br><span class="line">  在 MySQL 中，语法树（Syntax Tree），更准确地说是抽象语法树（Abstract Syntax Tree，AST），是对 SQL 语句进行解析后得到的一种树形结构表示.</span><br><span class="line">  当你向 MySQL 服务器发送一条 SQL 语句时，服务器首先会对该语句进行词法分析和语法分析。词法分析将 SQL 语句拆分成一个个的词法单元（Token），例如关键字、标识符、操作符等；语法分析则根据 SQL 的语法规则，将这些词法单元组织成一个树形结构，即抽象语法树。</span><br><span class="line"></span><br><span class="line">Optimizer：查询优化器</span><br><span class="line">  优化器可以通过分析抽象语法树来理解 SQL 语句的逻辑结构和语义，从而确定如何以最有效的方式执行查询。例如，它可以识别出哪些条件可以提前过滤数据，哪些表连接可以采用更高效的算法</span><br><span class="line">  根据解析器生成的解析树中的各个节点，生成不同的执行计划，然后决定一个最优的执行顺序路径，Mysql里面使用基于开销的优化器，哪种计划开销最小，就用哪种，从而保证在使用最少的开销的情况下返回正确的结果。</span><br><span class="line">  SQL语句在执行的时候，会先判断一下连接用户是否对特定表具有查询的权限，然后根据表的引擎定义，去使用这个引擎提供的接口。  </span><br></pre></td></tr></table></figure>

<h4 id="其它组件"><a href="#其它组件" class="headerlink" title="其它组件"></a>其它组件</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">存储引擎</span><br><span class="line">  存储引擎其实就是对于数据库文件的一种存取机制，如何实现存储数据，如何为存储的数据建立索引以及如何更新，查询数据等技术实现的方法。</span><br><span class="line">  MySQL 数据库中的数据，本质上来讲，是存在于硬盘上的物理文件，不同的存储引擎有不同的特性，实际上就是使用不同的技术和方式来管理文件中的数据。</span><br><span class="line">  存储引擎将存于硬盘上的物理文件，加载到内存中，然后再有上面的语句对内存中的数据，进行各种各样</span><br><span class="line">的操作。  </span><br></pre></td></tr></table></figure>

<h2 id="存储引擎-默认是InnoDB"><a href="#存储引擎-默认是InnoDB" class="headerlink" title="存储引擎(默认是InnoDB)"></a>存储引擎(默认是InnoDB)</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MySQL中的数据用各种不同的技术存储在文件（或者内存）中。这些技术中的每一种技术都使用不同的存储机制、索引技巧、锁定水平并且最终提供广泛的不同的功能和能力，此种技术称为存储引擎，MySQL 支持多种存储引擎，其中目前应用最广泛的是 InnoDB 和 MyISAM 两种。</span><br><span class="line"></span><br><span class="line">存储引擎决定了数据如何存储在磁盘上，以及如何被访问。它提供了数据的存储机制、索引技巧、锁定水平，并最终提供不同的功能和能力。具体的数据库里面的输入，如何存储到物理的数据文件里面，是由存储引擎来实现的。</span><br><span class="line"></span><br><span class="line">在 MySQL5.<span class="number">5</span> 之后默认存储引擎是 InnoDB，在之前是 MyISAM。</span><br><span class="line"></span><br><span class="line">Mysql<span class="literal">-server</span> <span class="number">8.0</span> 默认情况下存储引擎有 <span class="number">9</span>个，Mariadb <span class="number">10</span> 默认情况下存储引擎数量有 <span class="number">11</span>个。</span><br></pre></td></tr></table></figure>

<h4 id="MyISAM-存储引擎"><a href="#MyISAM-存储引擎" class="headerlink" title="MyISAM 存储引擎"></a><strong>MyISAM</strong> <strong>存储引擎</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">MyISAM 存储引擎特点</span><br><span class="line">- 不支持事务</span><br><span class="line">- 表级锁定</span><br><span class="line">- 读写相互阻塞，写入不能读，读时不能写</span><br><span class="line">- 只缓存索引</span><br><span class="line">- 不支持外键约束</span><br><span class="line">- 不支持聚簇索引</span><br><span class="line">- 支持全文索引</span><br><span class="line">- 读取数据较快，占用资源较少</span><br><span class="line">- 不支持MVCC（多版本并发控制机制）高并发</span><br><span class="line">- 崩溃恢复性较差</span><br><span class="line">- MySQL5.<span class="number">5.5</span> 前默认的数据库引擎</span><br><span class="line"></span><br><span class="line">MyISAM 存储引擎适用场景</span><br><span class="line">- 读多写少的业务（或者只读的业务）</span><br><span class="line">- 不需要事务支持的业务（比如转账，充值这种业务就不行）</span><br><span class="line">- 并发访问低的业务</span><br><span class="line">- 对数据一致性要求不高的业务</span><br><span class="line">- 表较小（可以接受长时间进行修复操作）</span><br><span class="line"></span><br><span class="line">MyISAM 存储引擎相关文件</span><br><span class="line">- tbl_name.frm 表格式定义</span><br><span class="line">- tbl_name.sdi 表格式定义（mysql8.<span class="number">0</span>开始，但是MariaDB目前依然在使用frm）</span><br><span class="line">- tbl_name.MYD 数据文件</span><br><span class="line">- tbl_name.MYI 索引文件</span><br></pre></td></tr></table></figure>

<h4 id="InnoDB-存储引擎"><a href="#InnoDB-存储引擎" class="headerlink" title="InnoDB 存储引擎"></a><strong>InnoDB</strong> <strong>存储引擎</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">InnoDB 存储引擎特点</span><br><span class="line">- 支持事务，适合处理大量短期事务</span><br><span class="line">- 行级锁定</span><br><span class="line">- 读写阻塞与事务隔离级别相关</span><br><span class="line">- 可缓存数据和索引</span><br><span class="line">- 支持聚簇索引</span><br><span class="line">- 崩溃恢复性更好</span><br><span class="line">- 支持MVCC高并发</span><br><span class="line">- 支持表分区，支持表空间</span><br><span class="line">- 从MySQL5.<span class="number">5</span> 后支持全文索引</span><br><span class="line">- 从MySQL5.<span class="number">5.5</span> 开始为默认的数据库引擎</span><br><span class="line"></span><br><span class="line">InnoDB 存储引擎适用场景</span><br><span class="line">- 数据读写都较为频繁的业务</span><br><span class="line">- 需要事务支持的业务</span><br><span class="line">- 对并发要求较高的业务</span><br><span class="line">- 对数据一致性要求较高的业务</span><br><span class="line"></span><br><span class="line">InnoDB 存储引擎相关文件</span><br><span class="line">- tbl_name.frm 表格式定义</span><br><span class="line">- tbl_name.ibd 数据和索引文件</span><br></pre></td></tr></table></figure>





<p><strong>MySQL****中常见的存储引擎特性说明</strong></p>
<table>
<thead>
<tr>
<th>特性（Feature）</th>
<th>MyISAM 存储引擎</th>
<th>Memory 存储引擎</th>
<th>InnoDB 存储引擎</th>
<th>Archive 存储引擎</th>
<th>NDB 存储引擎</th>
</tr>
</thead>
<tbody><tr>
<td>B 树索引（B - tree indexes）</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>备份时间点恢复（Backup&#x2F;point - in - time recovery）</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>集群模式（Cluster database support）</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>聚集索引（Clustered indexes）</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>数据压缩（Compressed data）</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>数据缓存（Data caches）</td>
<td>No</td>
<td>N&#x2F;A</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>数据加密（Encrypted data）</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>外键（Foreign key support）</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>全文检索（Full - text search indexes）</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>地理空间数据类型（Geospatial data type support）</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>地理空间数据索引（Geospatial indexing support）</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>HASH 索引（Hash indexes）</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>索引缓存（Index caches）</td>
<td>Yes</td>
<td>N&#x2F;A</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>锁颗粒度（Locking granularity）</td>
<td>Table</td>
<td>Table</td>
<td>Row</td>
<td>Row</td>
<td>Row</td>
</tr>
<tr>
<td>多版本并发控制（MVCC）</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>数据同步（Replication support）</td>
<td>Yes</td>
<td>Limited</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>表空间上限（Storage limits）</td>
<td>256TB</td>
<td>RAM</td>
<td>64TB</td>
<td>None</td>
<td>384EB</td>
</tr>
<tr>
<td>T 树索引（T - tree indexes）</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>事务（Transactions）</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>元数据静态更新（Update statistics for data dictionary）</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody></table>
<h4 id="表锁和行锁"><a href="#表锁和行锁" class="headerlink" title="表锁和行锁"></a>表锁和行锁</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">锁是计算机协调多个进程或线程并发访问某一资源的机制。</span><br><span class="line">在关系型数据库中，按数据操作的颗粒度划分，分为表锁，行锁和页锁</span><br><span class="line"></span><br><span class="line">表锁：</span><br><span class="line">  表锁是 MySQL 中锁定粒度最大的一种锁，表示对当前操作的整张表加锁（哪怕只操作表里面的一行数据），它实现简单，消耗资源少，被大部份 MySQL 存储引擎支持，MyISAM 存储引擎使用表锁，表级锁定分为表共享读锁（共享锁）与表独占写锁（排他锁）。</span><br><span class="line">  表锁的特点是开销小，加锁快，不会出现死锁，锁定颗粒度大，发生锁冲突的概率高，并发性差。</span><br><span class="line"></span><br><span class="line">行锁：</span><br><span class="line">  行锁是 MySQL 中锁定粒度最小的一种锁，表示只对当前操作的行加锁，行锁能大大减少数据库操作的冲突。其加锁粒度最小，但加锁的开销也最大。行级锁分为共享锁和排他锁。InnoDB存储引擎默认采用行锁。</span><br><span class="line">  行锁的特点是开销大，加锁慢，会出现死锁，锁定颗粒度最小，发生锁冲突的概率最低，并发性好。</span><br></pre></td></tr></table></figure>

<h4 id="表空间"><a href="#表空间" class="headerlink" title="表空间"></a>表空间</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">共享表空间</span><br><span class="line">  共享表空间是指表结构文件单独放在以数据命名的文件夹中，格式为 tbl_name.frm，所有 InnoDB 引擎表的数据都放在一个文件中 (ibdata1,ibdata2,...)。</span><br><span class="line">  </span><br><span class="line">独立表空间</span><br><span class="line">  独立表空间是指用独立文件存放每个表的表结构 tbl_name.frm 和数据及索引  tbl_name.ibd，在独立表空间的前提下，共享表空间中的 ibdata 文件还是存在，独立表空间文件只存储该表的数据，索引和插入缓冲的BITMAP等信息，其它信息还是存放在共享表空间中。</span><br></pre></td></tr></table></figure>

<h4 id="表结构与数据存储的分离"><a href="#表结构与数据存储的分离" class="headerlink" title="表结构与数据存储的分离"></a>表结构与数据存储的分离</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">表结构存储：</span><br><span class="line">   在 MySQL 数据库中，对于使用 InnoDB 引擎的表，其表结构文件是以.frm为后缀的，并且单独存放在以数据库名命名的文件夹中。比如有一个数据库叫mydb，里面有一张表mytable，那么mytable的表结构文件mytable.frm就会存放在mydb这个文件夹下。这种存储方式使得表结构的管理和维护相对独立，便于数据库系统快速定位和读取表的定义信息，比如表的列结构、索引结构等。</span><br><span class="line">数据存储：</span><br><span class="line">   所有 InnoDB 引擎表的数据并没有跟随各自的表结构文件分散存储，而是集中存放在ibdata1、ibdata2等这样的文件中。这意味着不同表的数据在物理存储上是聚合在一起的，形成了一个共享的空间来存储所有相关表的数据。</span><br></pre></td></tr></table></figure>

<h4 id="InnoDB-存储引擎中的-MVCC"><a href="#InnoDB-存储引擎中的-MVCC" class="headerlink" title="InnoDB 存储引擎中的 MVCC"></a><strong>InnoDB</strong> <strong>存储引擎中的</strong> <strong>MVCC</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MVCC（Multi<span class="literal">-Version</span> Concurrency Control）：多版本并发控制</span><br><span class="line">MVCC 是一种实现并发控制的方法，一般用在数据库管理系统中，实现对数据库的并发访问。</span><br><span class="line">    MVCC 使得大部份支持行锁的事务引擎，不再单纯的使用行锁来进行数据库的并发控制，而是把数据库的行锁与数据版本结合起来，只需要很小的开销，就可以实现非锁定读，从而大大提高了数据库系统的并发性能。</span><br></pre></td></tr></table></figure>

<h5 id="InnoDB-中的-MVCC"><a href="#InnoDB-中的-MVCC" class="headerlink" title="InnoDB 中的 MVCC"></a>InnoDB 中的 MVCC</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在MySQL中，使用 InnoDB 存储引擎的表，在创建时，系统会自动给表加上两个版本控制字段，这是两个隐藏列，这两个字段不显示在表结构中。</span><br><span class="line">其中一个字段保存了行的创建时间，一个保存了行的过期时间（或删除时间），（实际上存储的并不是时间，而是版本号，为了方便理解，我们认为记录的是时间）。</span><br><span class="line">当客户端要执行SQL语句时，会根据当前的时间与数据表中记录的时间进行比较，确保不会让客户端得到非法数据。</span><br></pre></td></tr></table></figure>

<h2 id="数据库服务配置"><a href="#数据库服务配置" class="headerlink" title="数据库服务配置"></a>数据库服务配置</h2><h3 id="数据库基本信息"><a href="#数据库基本信息" class="headerlink" title="数据库基本信息"></a>数据库基本信息</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql 数据库</span><br><span class="line">类似于Sql Server中的master库，主要负责存储数据库的用户、权限设置、关键字等mysql自己需要使用的控制和管理信息。</span><br><span class="line"></span><br><span class="line">information_schema 数据库</span><br><span class="line"></span><br><span class="line">performance_schema 数据库</span><br><span class="line">主要用于收集数据库服务器性能参数，库里表的存储引擎均为PERFORMANCE_SCHEMA，用户不能创建存储引擎为 PERFORMANCE_SCHEMA 的表</span><br></pre></td></tr></table></figure>

<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><h3 id="1-服务器系统变量"><a href="#1-服务器系统变量" class="headerlink" title="1 服务器系统变量"></a><strong>1</strong> <strong>服务器系统变量</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">服务器系统变量分为全局变量和会话变量两种，全局变量表示可以影响到所有连接终端，所有会话，会话变量只影响当前会话。</span><br><span class="line"></span><br><span class="line">全局变量在MySQL服务器启动时被初始化，并且对所有会话都有效。全局变量的值可以被所有会话共享，并且可以通过<span class="built_in">SET</span> GLOBAL语句进行修改（需要适当的权限）。一些全局变量定义了服务器的属性、特征，例如max_connections用于限制服务器的最大连接数。</span><br><span class="line"></span><br><span class="line">会话变量是特定于当前会话（连接）的变量。每个会话都有自己的一组会话变量，这些变量的值在会话期间是有效的，并且对其他会话是不可见的。会话变量可以通过<span class="built_in">SET</span> SESSION语句或<span class="built_in">SET</span>（不带GLOBAL或SESSION关键字，默认为会话级别）语句进行修改。一些会话变量可以复制全局变量的值作为其初始值，但之后可以在会话中独立修改。</span><br><span class="line"></span><br><span class="line">全局变量：数量相对较少，因为它们定义了服务器的整体行为和属性。</span><br><span class="line">会话变量：数量可能更多，因为每个会话都可以有自己的会话变量集合，并且这些变量可以在会话期间被动态创建和修改。</span><br></pre></td></tr></table></figure>

<h4 id="查看变量"><a href="#查看变量" class="headerlink" title="查看变量"></a>查看变量</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查看全局所有变量</span><br><span class="line">show global status\G</span><br><span class="line"></span><br><span class="line">查看指定变量</span><br><span class="line">show status like <span class="string">&#x27;Com_select&#x27;</span>;</span><br><span class="line"></span><br><span class="line">查看全局变量</span><br><span class="line">show global status like <span class="string">&#x27;Com_select&#x27;</span>;</span><br></pre></td></tr></table></figure>





<h4 id="会话变量修改"><a href="#会话变量修改" class="headerlink" title="会话变量修改"></a><strong>会话变量修改</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">修改会话变量：仅对当前会话有影响</span><br><span class="line"><span class="built_in">SET</span> [<span class="type">SESSION</span>] system_var_name=value;</span><br><span class="line"><span class="built_in">SET</span> <span class="selector-tag">@</span><span class="selector-tag">@</span>[<span class="type">session.</span>]system_var_name=value;</span><br><span class="line"></span><br><span class="line">只读变量无法修改</span><br><span class="line">变量无法实现永久保存，重启服务后会被重置</span><br></pre></td></tr></table></figure>

<h3 id="服务器状态变量"><a href="#服务器状态变量" class="headerlink" title="服务器状态变量"></a>服务器状态变量</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器状态变量：分全局和会话两种，其中许多变量有双重域，既是全局变量，也是会话变量，有相同的名字</span><br><span class="line">状态变量用于保存 MySQL 运行中的统计数据的变量，只读，不可修改。</span><br></pre></td></tr></table></figure>

<h4 id="服务器变量-sql-mode"><a href="#服务器变量-sql-mode" class="headerlink" title="服务器变量 sql_mode"></a><strong>服务器变量</strong> <strong>sql_mode</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sql_mode 是服务器选项，也是变量，其值会影响 SQL 语句执行的工作模式。</span><br><span class="line"></span><br><span class="line">服务器变量 sql_mode 是 MySQL 数据库中的一个重要系统变量，它用于控制 MySQL 如何处理 SQL 语句和数据校验。sql_mode 可以看作是一组约束和规范，用于确保数据的准确性、完整性和一致性。</span><br><span class="line">通过设置不同的 sql_mode 选项，可以改变 MySQL 的执行和处理方式，以适应不同的需求或标准。</span><br><span class="line"></span><br><span class="line">作用</span><br><span class="line">控制数据的插入、更新和删除操作，确保数据符合表的定义。</span><br><span class="line">对插入数据进行校验，如日期格式、数据类型长度等。</span><br><span class="line">改变 MySQL 对于字符串和数字之间的隐式转换规则。</span><br><span class="line">使 MySQL 的语法更加严格，符合 ANSI SQL 标准。</span><br><span class="line">提高 MySQL 的安全性，避免一些潜在的安全漏洞。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="INDEX-索引"><a href="#INDEX-索引" class="headerlink" title="INDEX 索引"></a><strong>INDEX</strong> <strong>索引</strong></h2><h3 id="索引介绍"><a href="#索引介绍" class="headerlink" title="索引介绍"></a>索引介绍</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">索引是 帮助 MySQL高效获取数据的 数据结构</span><br><span class="line">MySQL索引是一种特殊的数据库结构，由数据库表中一列或多列组合而成，主要用于加快数据的查询和检索速度。它类似于书籍的目录或字典的音序表，可以帮助数据库系统快速定位和获取所需的数据，从而提高查询性能。</span><br><span class="line"></span><br><span class="line">优点</span><br><span class="line">- 大大加快数据的检索速度;</span><br><span class="line">- 创建唯一性索引，保证数据库表中每一行数据的唯一性;</span><br><span class="line">- 加速表和表之间的连接;</span><br><span class="line">- 在使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间。</span><br><span class="line"></span><br><span class="line">缺点</span><br><span class="line">- 索引需要占物理空间。</span><br><span class="line">- 当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，降低了数据的维护速度</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="索引数据结构"><a href="#索引数据结构" class="headerlink" title="索引数据结构"></a><strong>索引数据结构</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">MySQL索引的算法和结构主要取决于存储引擎。对于InnoDB存储引擎，最常用的索引结构是B+树索引。</span><br><span class="line">B+树索引具有以下特点：</span><br><span class="line">    所有数据都会出现在叶子节点：叶子节点形成一个单向链表，便于范围搜索和排序。</span><br><span class="line">    非叶子节点仅起到索引数据作用：不存储实际数据，只存储索引，使得树的层级更低，性能更高。</span><br><span class="line"></span><br><span class="line">索引结构-树</span><br><span class="line">树的分类</span><br><span class="line">- 无序树：树中任意节点的子结点之间没有顺序关系</span><br><span class="line">- 有序树：树中任意节点的子结点之间有顺序关系</span><br><span class="line"></span><br><span class="line">- 二叉树：每个节点最多含有两个子树的树称为二叉树</span><br><span class="line">- 二叉查找树：</span><br><span class="line"> 首先它是一颗二叉树，</span><br><span class="line"> - 若左子树不空，则左子树上所有结点的值均小于它的根结点的值，</span><br><span class="line"> - 若右子树不空，则右子树上所有结点的值均大于它的根结点的值，</span><br><span class="line"> - 左、右子树也分别为二叉排序树</span><br><span class="line">- 满二叉树：叶节点除外的所有节点均含有两个子树的树被称为满二叉树</span><br><span class="line">- 完全二叉树：如果一颗二叉树除去最后一层节点为满二叉树，且最后一层的结点依次从左到右分布</span><br><span class="line">- 霍夫曼树：带权路径最短的二叉树</span><br><span class="line">- 红黑树：</span><br><span class="line"> 红黑树是一颗特殊的二叉查找树，</span><br><span class="line"> - 每个节点都是黑色或者红色，根节点、叶子节点是黑色。</span><br><span class="line"> - 如果一个节点是红色的，则它的子节点必须是黑色的</span><br><span class="line">- 平衡二叉树(AVL)：一 棵空树或它的左右两个子树的高度差的绝对值不超过<span class="number">1</span>，并且左右两个子树都是一棵平衡二叉树</span><br></pre></td></tr></table></figure>

<h4 id="B-树"><a href="#B-树" class="headerlink" title="**B-**树"></a>**B-**树</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B-树，读作B树，中间的横线是连字符，不是减号，B树将一个节点的大小设置为每个数据页(Page，也可以称为块，block)的大小，一般是<span class="number">16</span>KB，并且，B树中是将数据和索引放在一起的，以减少IO次数，加快查询速度，一个节点能放多少数据，通常取决于一条数据占用的空间大小。</span><br></pre></td></tr></table></figure>

<h4 id="B-树索引"><a href="#B-树索引" class="headerlink" title="**B+**树索引"></a>**B+**树索引</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">B+树是B-树的变体，也是一棵多路搜索树，MySQL普遍使用B+树来实现索引。</span><br><span class="line"></span><br><span class="line">B+树和B-树的主要区别：</span><br><span class="line">B-树内部节点是保存数据的，而B+树内部节点是不保存数据的，只作索引作用，它的叶子节点才保存数据。</span><br><span class="line">B+树相邻的叶子节点之间是通过链表指针连起来的，B-树却不是。</span><br><span class="line">查找过程中，B-树在找到具体的数值以后就结束，而B+树则需要通过索引找到叶子结点中的数据才结束</span><br><span class="line">B-树中任何一个关键字出现且只出现在一个结点中，而B+树可以出现多次。</span><br></pre></td></tr></table></figure>

<h4 id="B-树和B-树的主要区别"><a href="#B-树和B-树的主要区别" class="headerlink" title="B+树和B-树的主要区别"></a>B+树和B-树的主要区别</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">B-树内部节点是保存数据的，而B+树内部节点是不保存数据的，只作索引作用，它的叶子节点才保</span><br><span class="line">存数据。</span><br><span class="line">B+树相邻的叶子节点之间是通过链表指针连起来的，B-树却不是。</span><br><span class="line">查找过程中，B-树在找到具体的数值以后就结束，而B+树则需要通过索引找到叶子结点中的数据才结束</span><br><span class="line">B-树中任何一个关键字出现且只出现在一个结点中，而B+树可以出现多次。</span><br></pre></td></tr></table></figure>

<h4 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a><strong>查看索引</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM [<span class="type">db_name.</span>]tbl_name;</span><br></pre></td></tr></table></figure>

<h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE [<span class="type">UNIQUE</span>] INDEX index_name ON tbl_name (index_col_name[(<span class="type">length</span>)],...);</span><br><span class="line">ALTER TABLE tbl_name ADD INDEX index_name(index_col_name[(<span class="type">length</span>)]);</span><br><span class="line"></span><br><span class="line">语法示例：</span><br><span class="line"> CREATE INDEX idx_name ON student(name); </span><br><span class="line"> 创建一个索引，该索引包含 name 列的完整值。</span><br><span class="line"> 这意味着，无论 name 列中的字符串有多长，整个字符串都会被包含在索引中。</span><br><span class="line"> </span><br><span class="line"> CREATE INDEX idx_name ON student(name(<span class="number">10</span>)); </span><br><span class="line"> 创建一个前缀索引，该索引仅包含 name 列的前 <span class="number">10</span> 个字符。</span><br><span class="line"> 这意味着，索引是基于 name 列值的前 <span class="number">10</span> 个字符创建的</span><br></pre></td></tr></table></figure>

<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX index_name ON tbl_name;</span><br><span class="line">ALTER TABLE tbl_name DROP INDEX index_name(index_col_name);</span><br></pre></td></tr></table></figure>

<h4 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">所谓并发控制：是指多个进程同时读写一条数据的时候数据库对此情况的处理方式。</span><br><span class="line"></span><br><span class="line">锁机制</span><br><span class="line">读锁   共享锁，也称为 S 锁，只读不可写（包括当前事务），多个读互不阻塞</span><br><span class="line">写锁   独占锁，排它锁，也称为 X 锁，写锁会阻塞其它事务（不包括当前事务）的读和写</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">锁是加在索引上的,不是加在数据上的.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th>类别</th>
<th>详情</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>存储引擎</td>
<td>锁粒度</td>
<td>锁的实现</td>
<td>锁类型</td>
<td>说明</td>
</tr>
<tr>
<td>MyISAM</td>
<td>表级锁</td>
<td>存储引擎自行实现该引擎的锁策略和锁粒度</td>
<td>隐式锁</td>
<td>由存储引擎自动施加锁</td>
</tr>
<tr>
<td>MyISAM</td>
<td>表级锁</td>
<td>自行实现（在程序中或命令行下用命令显式实现）</td>
<td>显式锁</td>
<td>用户手动请求</td>
</tr>
<tr>
<td>InnoDB</td>
<td>行级锁</td>
<td>存储引擎自行实现该引擎的锁策略和锁粒度</td>
<td>隐式锁</td>
<td>由存储引擎自动施加锁</td>
</tr>
<tr>
<td>InnoDB</td>
<td>行级锁</td>
<td>自行实现（在程序中或命令行下用命令显式实现）</td>
<td>显式锁</td>
<td>用户手动请求</td>
</tr>
</tbody></table>
<h4 id="锁命令"><a href="#锁命令" class="headerlink" title="锁命令"></a>锁命令</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">加读锁</span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; lock tables student read;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">释放读锁</span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; unlock tables;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line">加写锁</span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; lock table student <span class="built_in">write</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">释放写锁</span><br><span class="line">连接或进程只能释放其自身施加的锁。一个session只能为自己获取锁和释放锁，不能为其他session获取锁，也不能释放由其他session保持的锁。</span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; unlock tables ;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">关闭正在打开的表（清除查询缓存），通常在备份前加全局读锁</span><br><span class="line">FLUSH TABLES [<span class="type">tb_name</span>[,<span class="type">...</span>]] [<span class="type">WITH</span> <span class="type">READ</span> <span class="type">LOCK</span>]</span><br><span class="line"></span><br><span class="line">关闭所有打开的表，强制关闭所有正在使用的表，并刷新查询缓存和预准备语句缓存，不会刷新脏块</span><br><span class="line">FLUSH TABLES</span><br><span class="line"></span><br><span class="line">关闭所有打开的表并使用全局读锁锁定所有数据库的所有表，不会刷新脏块,也不阻塞日志表写入，例如查询日志，慢日志等</span><br><span class="line">FLUSH TABLES WITH READ LOCK</span><br><span class="line"></span><br><span class="line">操作指定表</span><br><span class="line">FLUSH TABLES tbl_name tb_name[,<span class="type">...</span>] WITH READ LOCK</span><br><span class="line"></span><br><span class="line">刷新脏块, 脏块也称为脏页，当内存数据页和磁盘数据页上的内容不一致时，我们称这个内存页为脏页</span><br><span class="line">FLUSH TABLES tbl_name [<span class="type">tb_name</span>[,<span class="type">...</span>]] <span class="keyword">FOR</span> EXPORT</span><br></pre></td></tr></table></figure>

<h4 id="事务基础"><a href="#事务基础" class="headerlink" title="事务基础"></a>事务基础</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">事务</span><br><span class="line">事务是一组具有原子性的 SQL 语句，或者说一个独立单元。可以理解为一个事务对应的是一组完整的业务，这个业务有一条或多条 SQL 语句组成。所谓原子性是指，这一组业务中的 SQL 语句不可分割，所以，要么全部 SQL 语句都执行成功，事务也就执行成功；只要有一条 SQL 语句执行失败，则整个事务都要回滚到事务开始前。</span><br><span class="line"></span><br><span class="line">事务特性</span><br><span class="line">原子性( Atomicity )</span><br><span class="line">  原子性又称不可分割性。一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。</span><br><span class="line"></span><br><span class="line">一致性( Consistency )</span><br><span class="line">   事务的执行结果，必须是符合预期的，这表示在事务中进行的数据读写，完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。</span><br><span class="line"></span><br><span class="line">隔离性( Isolation )</span><br><span class="line">  隔离性又称独立性。MySQL 允许多个事务并发，同时进行写操作，隔离性用于实现事务的并发控制，防止多个事务并发执行时的交叉执行而导致的数据不一致。</span><br><span class="line">  事务的隔离分为不同的级别，包括读未提交( Read uncommitted )，读提交( read committed )，可重复读( repeatable read )，串行化( Serializable )。</span><br><span class="line">  </span><br><span class="line">持久性( Durability )</span><br><span class="line">事务执行成功后，其对于数据的修改会永久保存于数据库中。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">显式启动事务 语法解读</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">BEGIN</span> WORK</span><br><span class="line"><span class="built_in">START</span> TRANSACTION</span><br><span class="line"></span><br><span class="line">结束事务</span><br><span class="line"><span class="comment">#提交执行</span></span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment">#回滚</span></span><br><span class="line">ROLLBACK</span><br></pre></td></tr></table></figure>

<h4 id="自动提交能力"><a href="#自动提交能力" class="headerlink" title="自动提交能力"></a><strong>自动提交能力</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">对于mysql来说，每一个对于数据的增删改的动作，都是一个事务，为什么我们操作过数据之后，另外的终端可以立刻生效呢？</span><br><span class="line">原因是，mysql对于这种操作，启用了 自动提交的能力。</span><br><span class="line"></span><br><span class="line">默认开始自动提交</span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; <span class="built_in">select</span> <span class="selector-tag">@</span>@autocommit;</span><br><span class="line">+<span class="literal">--------------</span>+</span><br><span class="line">| <span class="selector-tag">@</span>@autocommit |</span><br><span class="line">+<span class="literal">--------------</span>+</span><br><span class="line">|            <span class="number">1</span> |</span><br><span class="line">+<span class="literal">--------------</span>+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">关闭自动提交</span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; <span class="built_in">set</span> autocommit=<span class="number">0</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; <span class="built_in">select</span> <span class="selector-tag">@</span>@autocommit;</span><br><span class="line">+<span class="literal">--------------</span>+</span><br><span class="line">| <span class="selector-tag">@</span>@autocommit |</span><br><span class="line">+<span class="literal">--------------</span>+</span><br><span class="line">|            <span class="number">0</span> |</span><br><span class="line">+<span class="literal">--------------</span>+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="查看事务"><a href="#查看事务" class="headerlink" title="查看事务"></a>查看事务</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前正在进行的事务</span></span><br><span class="line"><span class="built_in">SELECT</span> * FROM INFORMATION_SCHEMA.INNODB_TRX;</span><br></pre></td></tr></table></figure>

<h4 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">死锁是指两个或两个以上的进程在执行过程中，因争夺资源而造成的一种互相等待的现象，若无外力作用，它们都将无法推进下去，此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等的进程称为死锁进程。</span><br><span class="line"></span><br><span class="line">死锁语法解析</span><br><span class="line">查看innodb状态，可以查看锁信息</span><br><span class="line">show engine innodb status;</span><br><span class="line">查看正在进行中的事务</span><br><span class="line"><span class="built_in">SELECT</span> * FROM information_schema.INNODB_TRX;</span><br><span class="line">查看锁</span><br><span class="line"><span class="built_in">SELECT</span> * FROM information_schema.INNODB_LOCKS;</span><br><span class="line">MySQL8.<span class="number">0.13</span> 及以后使用此语句查看锁</span><br><span class="line"><span class="built_in">SELECT</span> * FROM performance_schema.data_locks;</span><br><span class="line">查看锁等待</span><br><span class="line"><span class="built_in">SELECT</span> * FROM information_schema.INNODB_LOCK_WAITS;</span><br><span class="line">MySQL8.<span class="number">0.13</span>及以后使用此语句查看锁等待</span><br><span class="line"><span class="built_in">SELECT</span> * FROM performance_schema.data_lock_waits;</span><br></pre></td></tr></table></figure>

<h4 id="事务隔离"><a href="#事务隔离" class="headerlink" title="事务隔离"></a>事务隔离</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MySQL 的事务隔离级别一共有四个，分别是 读未提交、读已提交、可重复读 以及 可串行化。MySQL 的隔离级别的作用就是让事务之间互相隔离，互不影响，这样可以保证事务的一致性。</span><br><span class="line"></span><br><span class="line">读未提交（READ UNCOMMITTED）</span><br><span class="line">  在读未提交隔离级别下，事务A可以读取到事务B修改过但未提交的数据。可能发生 脏读、不可重复读和 幻读问题，一般很少使用此隔离级别。</span><br><span class="line">  简单来说：你没有提交的时候，我就看到你修改的数据</span><br><span class="line"></span><br><span class="line">读已提交（READ COMMITTED）</span><br><span class="line">  在读已提交隔离级别下，事务B只能在事务A修改过并且已提交后才能读取到事务B修改的数据。读已提交隔离级别解决了脏读的问题，但可能发生不可重复读和幻读问题，一般很少使用此隔离级别。</span><br><span class="line">  简单来说：你提交后，我才可以看到你修改的数据。</span><br><span class="line"></span><br><span class="line">可重复读（REPEATABLE READ）</span><br><span class="line">  在可重复读隔离级别下，事务B只能在事务A修改过数据并提交后，自己也提交事务后，才能读取到事务B修改的数据。可重复读隔离级别解决了脏读和不可重复读的问题，但可能发生幻读问题。</span><br><span class="line">  简单来说，你提交了，我也提交了，我才有能力读自己的数据。</span><br><span class="line"></span><br><span class="line">可串行化（SERIALIZABLE）</span><br><span class="line">  可串行化，又称序列化。各种问题（脏读、不可重复读、幻读）都不会发生，通过加锁实现（读锁和写锁）。</span><br><span class="line">  简单来说；咱们俩，谁先开始【另外一个人处于等待状态】，谁后开始的问题。</span><br><span class="line">  </span><br><span class="line">以上四种隔离级别，从上往下，隔离强度逐渐增强，性能逐渐变差，需要消耗的 MySQL 的资源越多，</span><br><span class="line">所以并不是隔离强度越高越好，采用哪种隔离级别要根据系统需求权衡决定，MySQL 中默认的隔离级</span><br><span class="line">别是可重复读。</span><br></pre></td></tr></table></figure>

<h4 id="事务并发中可能出现的问题"><a href="#事务并发中可能出现的问题" class="headerlink" title="事务并发中可能出现的问题"></a><strong>事务并发中可能出现的问题</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">脏读（Dirty Read） - 只在 读未提交 隔离级别才会出现</span><br><span class="line">脏读指的是读到了其他事务未提交的数据，未提交意味着这些数据可能会回滚，也就是可能最终不会存到数据库中，也就是不存在的数据。读到了并不一定最终存在的数据，这就是脏读。</span><br><span class="line"></span><br><span class="line">不可重复读（Non<span class="literal">-Repeatable</span> Read） - 在 读未提交 和 读已提交 隔离级别都可能会出现</span><br><span class="line">不可重复读指的是在同一事务内，不同的时刻读到的同一批数据可能是不一样的，可能会受到其他事务的影响，比如其他事务改了这批数据并提交了。</span><br><span class="line"></span><br><span class="line">幻读（Phantom）-在 读未提交、读已提交、可重复读 隔离级别都可能会出现</span><br><span class="line">一个事务先根据某些条件查询出一些记录，之后另一个事务又向表中插入了符合这些条件的记录，原先的事务再次按照该条件查询时，能把另一个事务插入的记录也读出来。</span><br></pre></td></tr></table></figure>

<h4 id="MVCC和事务的隔离级别"><a href="#MVCC和事务的隔离级别" class="headerlink" title="MVCC和事务的隔离级别"></a><strong>MVCC</strong>和事务的隔离级别</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MVCC（多版本并发控制机制）只在 READ COMMITTED 和 REPEATABLE READ 两个隔离级别下工作。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h3><h4 id="MySQL的日志类型"><a href="#MySQL的日志类型" class="headerlink" title="MySQL的日志类型"></a><strong>MySQL</strong>的日志类型</h4><p>MySQL 支持丰富的日志类型，主要有以下六种：</p>
<table>
<thead>
<tr>
<th>日志类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>事务日志</td>
<td>记录 InnoDB 等支持事务的存储引擎执行事务时产生的日志，其写入类型为顺序 IO</td>
</tr>
<tr>
<td>错误日志</td>
<td>记录 MySQL 服务的启动、运行或停止 MySQL 服务时出现的问题，通常也会记录 Warning</td>
</tr>
<tr>
<td>通用日志</td>
<td>又称查询日志，记录建立的客户端连接和执行的语句</td>
</tr>
<tr>
<td>慢查询日志</td>
<td>记录所有执行时间超过 long_query_time 的所有查询或不使用索引的查询，有助于定位性能问题</td>
</tr>
<tr>
<td>二进制日志</td>
<td>记录所有更改数据的语句，主要用于复制和即时点恢复</td>
</tr>
<tr>
<td>中继日志</td>
<td>从主服务器的二进制日志文件中复制而来的事件，并保存为的日志文件，与二进制日志几乎相同</td>
</tr>
</tbody></table>
<h4 id="事务日志"><a href="#事务日志" class="headerlink" title="事务日志"></a>事务日志</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Mariadb 查看日志信息</span><br><span class="line"><span class="comment">#MariaDB中的相关变量</span></span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; show variables like <span class="string">&#x27;%innodb_log%&#x27;</span>;</span><br><span class="line">+<span class="literal">-----------------------------</span>+<span class="literal">-----------</span>+</span><br><span class="line">| Variable_name               | Value     |</span><br><span class="line">+<span class="literal">-----------------------------</span>+<span class="literal">-----------</span>+</span><br><span class="line">| innodb_log_buffer_size      | <span class="number">16777216</span>  |</span><br><span class="line">| innodb_log_checksums        | ON        |</span><br><span class="line">| innodb_log_compressed_pages | ON        |</span><br><span class="line">| innodb_log_file_size        | <span class="number">100663296</span> |</span><br><span class="line">| innodb_log_files_in_group   | <span class="number">1</span>         |</span><br><span class="line">| innodb_log_group_home_dir   | ./        |</span><br><span class="line">| innodb_log_optimize_ddl     | OFF       |</span><br><span class="line">| innodb_log_write_ahead_size | <span class="number">8192</span>      |</span><br><span class="line">+<span class="literal">-----------------------------</span>+<span class="literal">-----------</span>+</span><br><span class="line"><span class="number">8</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line">确认日志所处的位置</span><br><span class="line">MariaDB [<span class="type">testdb</span>]&gt; show variables like <span class="string">&#x27;%datadir%&#x27;</span>;</span><br><span class="line">+<span class="literal">---------------</span>+<span class="literal">-------------------</span>+</span><br><span class="line">| Variable_name | Value             |</span><br><span class="line">+<span class="literal">---------------</span>+<span class="literal">-------------------</span>+</span><br><span class="line">| datadir       | /mysql/<span class="number">3306</span>/<span class="keyword">data</span>/ |</span><br><span class="line">+<span class="literal">---------------</span>+<span class="literal">-------------------</span>+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.001</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="事务日志性能优化"><a href="#事务日志性能优化" class="headerlink" title="事务日志性能优化"></a>事务日志性能优化</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redo log 包含日志缓冲（redo log buffer）和磁盘上的日志文件（redo logfile）两部分。</span><br><span class="line">MySQL 每执行新一条 DML 语句都会先将日志记录在 redo log buffer 中，然后再根据不同的配置项，使用不同的规则将 redo log buffer 中的数据落盘（写入到 redo log file）。</span><br><span class="line">但是，redo log buffer 是用户空间的数据，无法直接写入磁盘，中间必须经过操作系统缓冲区（OS Buffer），因此，从 redo log buffer 到 redo log file，实际上会先写 OS Buffer，再调用fsync() 将其刷人入到 redo log file 中。</span><br></pre></td></tr></table></figure>

<h4 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MySQL 中错误日志中记录的主要内容</span><br><span class="line">- mysqld 启动和关闭过程中输出的事件信息</span><br><span class="line">- mysqld 运行中产生的错误信息</span><br><span class="line">- event scheduler 运行一个 event 时产生的日志信息</span><br><span class="line">- 在主从复制架构中的从服务器上启动从服务器线程时产生的信息</span><br></pre></td></tr></table></figure>

<h4 id="通用日志"><a href="#通用日志" class="headerlink" title="通用日志"></a>通用日志</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通用日志</span><br><span class="line">  通用日志，又称通用查询日志（General Query Log），用来记录对数据库的所有操作，包括启动和关闭 MySQL 服务、更新语句和查询语句等。默认情况下，通用查询日志功能是关闭的。</span><br><span class="line">  可以通过配置开启此日志，并决定将日志存储到文件或数据表中。如果选择记录到数据表中，则具体的表是 mysql.general_log</span><br></pre></td></tr></table></figure>

<h4 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  慢查询日志用来记录在 MySQL 中执行时间超过指定时间的查询语句。通过慢查询日志，可以查找出哪些查询语句的执行效率低，以便进行优化。</span><br><span class="line">  慢查询日志默认不开启。</span><br><span class="line"></span><br><span class="line">Mariadb环境查看</span><br><span class="line">MariaDB [<span class="type">mysql</span>]&gt; <span class="built_in">select</span> <span class="selector-tag">@</span>@slow_query_log,<span class="selector-tag">@</span>@slow_query_log_file,<span class="selector-tag">@</span>@long_query_time;</span><br><span class="line">+<span class="literal">------------------</span>+<span class="literal">-----------------------</span>+<span class="literal">-------------------</span>+</span><br><span class="line">| <span class="selector-tag">@</span>@slow_query_log | <span class="selector-tag">@</span>@slow_query_log_file | <span class="selector-tag">@</span>@long_query_time |</span><br><span class="line">+<span class="literal">------------------</span>+<span class="literal">-----------------------</span>+<span class="literal">-------------------</span>+</span><br><span class="line">|                <span class="number">0</span> | bogon<span class="literal">-slow</span>.log        |         <span class="number">10.000000</span> |</span><br><span class="line">+<span class="literal">------------------</span>+<span class="literal">-----------------------</span>+<span class="literal">-------------------</span>+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">开启慢查询日志</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   二进制日志（Binary Log）也可叫作变更日志（Update Log），是 MySQL 中非常重要的日志。主要用于记录数据库的变化情况，即 SQL 语句的 DDL 和 DML 语句，但不包含查询操作语句，因为查询语句并不会改变数据库中的数据。</span><br><span class="line">   如果 MySQL 数据库意外停止，可以通过二进制日志文件来查看用户执行了哪些操作，对数据库服务器文件做了哪些修改，然后根据二进制日志文件中的记录来恢复数据库服务器。</span><br><span class="line">   </span><br><span class="line">事务日志和二进制区别</span><br><span class="line">- 事务日志可以看作是在线日志，二进制日志可以看作是离线日志</span><br><span class="line">- 事务日志记录事务执行的过程，包括提交和未提交，二进制日志记录只记提交的过程</span><br><span class="line">- 事务日志只支持 InnoDB 存储引擎，二进制支持 InnoDB 和 MyISAM 存储引擎</span><br><span class="line">- 事务日志的容量是<span class="number">100</span>M的大小，会滚动覆盖式更新，二进制的容量大小没有限制。</span><br><span class="line"></span><br><span class="line">二进制日志记录三种格式</span><br><span class="line">- Statement：基于语句的记录模式，日志中会记录原生执行的 SQL 语句，对于某些函数或变量，不会替换。</span><br><span class="line">- Row：基于行的记录模式，会将 SQL 语句中的变量和函数进行替换后再记录。</span><br><span class="line">- Mixed：混合记录模式，在此模式下，MySQL 会根据具体的 SQL 语句来分析采用哪种模式记录日志。</span><br></pre></td></tr></table></figure>

<h4 id="查看二进制文件"><a href="#查看二进制文件" class="headerlink" title="查看二进制文件"></a>查看二进制文件</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [<span class="type">db2</span>]&gt; <span class="built_in">select</span> <span class="selector-tag">@</span>@binlog_format;</span><br><span class="line">+<span class="literal">-----------------</span>+</span><br><span class="line">| <span class="selector-tag">@</span>@binlog_format |</span><br><span class="line">+<span class="literal">-----------------</span>+</span><br><span class="line">| MIXED           |</span><br><span class="line">+<span class="literal">-----------------</span>+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">查看当前服务的二进制文件列表</span><br><span class="line">SHOW &#123;BINARY | MASTER&#125; LOGS</span><br><span class="line">查看正在使用的二进制文件</span><br><span class="line">SHOW MASTER STATUS</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">John Doe</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://lx1me.github.io/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93-1/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://lx1me.github.io/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93-1/')">Hexo</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://lx1me.github.io/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93-1/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Hexo&amp;url=https://lx1me.github.io/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93-1/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lx1me.github.io" target="_blank">Hexo</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/06/05/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/2025/06/05/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%20Git%20%E5%92%8C%20GitLab/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="toc-number">1.</span> <span class="toc-text">MySQL 数据库-1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E6%9E%B6%E6%9E%84%E5%92%8C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">MySQL 架构和性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">mysql组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%99%A8"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">连接器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">线程池</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.0.3.</span> <span class="toc-text">SQL语句解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.0.4.</span> <span class="toc-text">其它组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-%E9%BB%98%E8%AE%A4%E6%98%AFInnoDB"><span class="toc-number">1.3.</span> <span class="toc-text">存储引擎(默认是InnoDB)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MyISAM-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">MyISAM 存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">InnoDB 存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E9%94%81%E5%92%8C%E8%A1%8C%E9%94%81"><span class="toc-number">1.3.0.3.</span> <span class="toc-text">表锁和行锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E7%A9%BA%E9%97%B4"><span class="toc-number">1.3.0.4.</span> <span class="toc-text">表空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%9A%84%E5%88%86%E7%A6%BB"><span class="toc-number">1.3.0.5.</span> <span class="toc-text">表结构与数据存储的分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%B8%AD%E7%9A%84-MVCC"><span class="toc-number">1.3.0.6.</span> <span class="toc-text">InnoDB 存储引擎中的 MVCC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#InnoDB-%E4%B8%AD%E7%9A%84-MVCC"><span class="toc-number">1.3.0.6.1.</span> <span class="toc-text">InnoDB 中的 MVCC</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.</span> <span class="toc-text">数据库服务配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.1.</span> <span class="toc-text">数据库基本信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.5.</span> <span class="toc-text">环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">1.5.1.</span> <span class="toc-text">1 服务器系统变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8F%98%E9%87%8F"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">查看变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%8F%98%E9%87%8F%E4%BF%AE%E6%94%B9"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">会话变量修改</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F"><span class="toc-number">1.5.2.</span> <span class="toc-text">服务器状态变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%98%E9%87%8F-sql-mode"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">服务器变量 sql_mode</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#INDEX-%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.</span> <span class="toc-text">INDEX 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.1.</span> <span class="toc-text">索引介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">索引数据结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E6%A0%91"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">**B-**树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E6%A0%91%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">**B+**树索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E6%A0%91%E5%92%8CB-%E6%A0%91%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">B+树和B-树的主要区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">查看索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.1.6.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.1.7.</span> <span class="toc-text">删除索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">1.6.1.8.</span> <span class="toc-text">并发控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">1.6.1.9.</span> <span class="toc-text">锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.1.10.</span> <span class="toc-text">锁命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">1.6.1.11.</span> <span class="toc-text">全局锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%9F%BA%E7%A1%80"><span class="toc-number">1.6.1.12.</span> <span class="toc-text">事务基础</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.1.13.</span> <span class="toc-text">事务管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E8%83%BD%E5%8A%9B"><span class="toc-number">1.6.1.14.</span> <span class="toc-text">自动提交能力</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.6.1.15.</span> <span class="toc-text">查看事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-number">1.6.1.16.</span> <span class="toc-text">死锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB"><span class="toc-number">1.6.1.17.</span> <span class="toc-text">事务隔离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%B9%B6%E5%8F%91%E4%B8%AD%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.1.18.</span> <span class="toc-text">事务并发中可能出现的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MVCC%E5%92%8C%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.1.19.</span> <span class="toc-text">MVCC和事务的隔离级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.2.</span> <span class="toc-text">日志管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL%E7%9A%84%E6%97%A5%E5%BF%97%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">MySQL的日志类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">事务日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">事务日志性能优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">错误日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.2.5.</span> <span class="toc-text">通用日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.2.6.</span> <span class="toc-text">慢查询日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.2.7.</span> <span class="toc-text">二进制日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.2.8.</span> <span class="toc-text">查看二进制文件</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.118Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%20Docker/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.113Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%20ZABBIX/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.113Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%A0%A1%E5%9E%92%E6%9C%BA%20JumpServer/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.108Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/05/%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%B0%83%E5%BA%A6%E5%99%A8LVS/" title="无题">无题</a><time datetime="2025-06-05T01:52:55.108Z" title="发表于 2025-06-05 09:52:55">2025-06-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="John Doe" target="_blank">John Doe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 John Doe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>